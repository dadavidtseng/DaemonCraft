{
  "id": "snapshot_1764294279128_q13s0nt31",
  "approvalId": "approval_1764294279096_iagbi9svx",
  "approvalTitle": "A7-AI requirements.md - AI Agent Integration",
  "version": 1,
  "timestamp": "2025-11-28T01:44:39.128Z",
  "trigger": "initial",
  "status": "pending",
  "content": "# Assignment 7-AI: AI Agent Integration (KADI WebSocket, Agent Framework)\r\n\r\n**Due Date:** December 12, 2025 (Week 4)\r\n**Estimated Duration:** 1 week\r\n**Complexity:** High (Network integration, multi-agent system)\r\n**Implementation Standard:** ⭐ **Follow Minecraft Implementation Patterns** ⭐\r\n**Dependencies:** ✅ Requires A7-Core completion (Registry, Inventory systems)\r\n\r\n---\r\n\r\n## Executive Summary\r\n\r\nAssignment 7-AI implements the AI agent framework and KADI WebSocket integration, enabling Claude Desktop/Code to control autonomous agents in SimpleMiner:\r\n\r\n1. **AIAgent Entity Class** - Autonomous entity with inventory and command queue\r\n2. **Agent Command System** - MOVE, MINE, PLACE, CRAFT, WAIT commands\r\n3. **Agent Vision System** - Query nearby blocks and entities\r\n4. **KADI WebSocket Integration** - 7 MCP tools for agent control (using KADIWebSocketSubsystem)\r\n5. **TypeScript Agent Framework** - Example agent behaviors (deployed on DigitalOcean)\r\n\r\nThis assignment completes Assignment 7 by enabling AI-game integration, allowing Claude to spawn and control 3-10 autonomous agents that can mine, build, and interact with the world.\r\n\r\n---\r\n\r\n## Project Context\r\n\r\n### Current State (Post-A7-Core)\r\n\r\n**Existing Systems from A7-Core:**\r\n- ✅ Registry<T> template for type-safe ID management\r\n- ✅ ItemRegistry, BlockRegistry, RecipeRegistry (JSON-based)\r\n- ✅ ItemStack data structure (itemID, quantity, durability)\r\n- ✅ Player inventory (36 slots: 27 main + 9 hotbar)\r\n- ✅ ItemEntity for dropped items (magnetic pickup, world physics)\r\n- ✅ Mining mechanics (progressive break, block → item drop)\r\n- ✅ Placement mechanics (consume inventory, place block)\r\n- ✅ Entity system (base class with physics)\r\n\r\n**Available Infrastructure:**\r\n- Engine KADIWebSocketSubsystem: WebSocket communication with kadi-broker\r\n- Existing KADI prototype: ProtogameJS3D (reference implementation)\r\n- Deployed Agent_TypeScript on DigitalOcean droplet\r\n- Entity base class: Physics-enabled entities with position, velocity\r\n\r\n### Target State (Post-A7-AI)\r\n\r\n**New Systems:**\r\n- ✅ AIAgent entity class (extends Entity, has Inventory + CommandQueue)\r\n- ✅ Agent command system (MOVE, MINE, PLACE, CRAFT, WAIT)\r\n- ✅ Agent vision system (nearby blocks/entities, 3D sphere query)\r\n- ✅ KADI WebSocket integration (7 MCP tools with PascalCase_With_Underscores naming)\r\n- ✅ TypeScript agent framework (MinerAgent, BuilderAgent)\r\n\r\n---\r\n\r\n## Goals and Objectives\r\n\r\n### Primary Goals\r\n\r\n1. **AI Agent Framework** - Enable 3-10 autonomous agents with command execution\r\n2. **KADI WebSocket Integration** - Expose SimpleMiner to Claude Desktop via MCP tools\r\n3. **Agent Behaviors** - Create example TypeScript agents (MinerAgent, BuilderAgent)\r\n4. **Multi-Agent Support** - Handle 3-10 concurrent agents without frame drops\r\n\r\n### Secondary Goals\r\n\r\n1. **Performance** - Maintain 60 FPS with 3-10 active agents\r\n2. **Extensibility** - Design for future goal-based AI (defer to future assignment)\r\n3. **Debugging** - Visualize agent state (name tags, command queue, vision range)\r\n\r\n### Non-Goals (Explicitly Out of Scope for A7-AI)\r\n\r\n- ❌ Goal-based AI (command execution only for A7)\r\n- ❌ Pathfinding (simple movement commands only)\r\n- ❌ Agent-agent cooperation (agents work independently)\r\n- ❌ Combat AI (no damage/health system yet)\r\n- ❌ Advanced behaviors (building planning, resource optimization)\r\n- ❌ Menu system (deferred to A7-Polish)\r\n- ❌ Sound effects (deferred to A7-Polish)\r\n\r\n---\r\n\r\n## Functional Requirements\r\n\r\n### FR-1: AIAgent Entity Class\r\n\r\n#### FR-1.1: AIAgent Class Design\r\n**Description**: Entity subclass for AI-controlled agents.\r\n\r\n**Requirements**:\r\n- **Extend Entity Base Class**:\r\n  - Inherit physics (position, velocity, gravity, collision)\r\n  - Inherit rendering (cube model with distinct color)\r\n- **Agent Properties**:\r\n  - `std::string m_agentName` - Unique identifier (e.g., \"MinerBot\")\r\n  - `uint64_t m_agentID` - Numeric ID for KADI tracking\r\n  - `std::queue<AgentCommand> m_commandQueue` - Queued commands\r\n  - `Inventory m_inventory` - 36 slots (same as player, from A7-Core)\r\n  - `float m_visionRange` - Blocks agent can \"see\" (default: 10.0f)\r\n  - `AgentCommandState m_currentCommand` - Currently executing command\r\n- **Agent Lifecycle**:\r\n  - Spawn at specified coordinates (via KADI tool or debug command)\r\n  - Update every frame (execute command queue)\r\n  - Despawn on death or KADI command\r\n- **Rendering**:\r\n  - Distinct color from player (e.g., blue cube for agents, player is green)\r\n  - Name tag above agent (using debug text system)\r\n  - Optional: Velocity vectors in debug mode (F3 toggle)\r\n\r\n**Acceptance Criteria**:\r\n```cpp\r\nAIAgent* agent = world->SpawnAgent(\"MinerBot\", Vec3(100, 100, 70));\r\nagent->QueueCommand(AgentCommand::MOVE, {direction: Vec3(1,0,0), duration: 2.0f});\r\nagent->QueueCommand(AgentCommand::MINE, {coords: IntVec3(101, 100, 70)});\r\n// Agent executes commands sequentially over multiple frames\r\n```\r\n\r\n#### FR-1.2: Command Queue Processing\r\n**Description**: Execute queued commands frame-by-frame.\r\n\r\n**Requirements**:\r\n- **Command Queue**:\r\n  - `std::queue<AgentCommand>` - First-in, first-out\r\n  - Pop one command per frame when previous completes\r\n  - Continue until queue empty\r\n- **Command Execution**:\r\n  - Each command has `Execute()` and `IsComplete()` methods\r\n  - MOVE: Apply velocity over duration\r\n  - MINE: Raycast to block, apply mining progress (reuse player mining logic)\r\n  - PLACE: Raycast for placement position, place block (reuse player placement logic)\r\n  - CRAFT: Match recipe in inventory crafting grid, craft item\r\n  - WAIT: Idle for duration\r\n- **Command State Machine**:\r\n  - QUEUED → IN_PROGRESS → COMPLETED/FAILED\r\n  - Completed commands removed from queue\r\n  - Failed commands log error, continue to next command\r\n- **Completion Notification**:\r\n  - Send WebSocket message to KADI when command completes\r\n  - Include success/failure status, error message (if failed)\r\n\r\n**Acceptance Criteria**:\r\n- Agent executes commands in order (FIFO queue)\r\n- Commands complete or fail gracefully (no crashes)\r\n- Agent idles when queue empty\r\n- KADI receives completion notifications\r\n\r\n---\r\n\r\n### FR-2: Agent Command System\r\n\r\n#### FR-2.1: AgentCommand Enum and Data\r\n**Description**: Define agent action primitives (command execution, not goal-based).\r\n\r\n**Requirements**:\r\n- **AgentCommand Enum**:\r\n  ```cpp\r\n  enum class eAgentCommandType\r\n  {\r\n      MOVE,      // Move in direction for duration\r\n      MINE,      // Break block at coordinates\r\n      PLACE,     // Place block from inventory\r\n      CRAFT,     // Execute crafting recipe\r\n      WAIT       // Idle for duration\r\n  };\r\n  ```\r\n- **Command Parameters** (variant/union struct):\r\n  ```cpp\r\n  struct AgentCommandParams\r\n  {\r\n      // MOVE parameters\r\n      Vec3 direction;       // Normalized direction vector\r\n      float duration;       // Seconds to move\r\n\r\n      // MINE/PLACE parameters\r\n      IntVec3 blockCoords;  // World block coordinates\r\n      uint16_t blockType;   // Block type to place (PLACE only)\r\n\r\n      // CRAFT parameters\r\n      uint16_t recipeID;    // Recipe index in RecipeRegistry\r\n  };\r\n  ```\r\n- **AgentCommand Class**:\r\n  ```cpp\r\n  class AgentCommand\r\n  {\r\n  public:\r\n      eAgentCommandType GetType() const;\r\n      void Execute(AIAgent* agent, float deltaSeconds);\r\n      bool IsComplete() const;\r\n      bool IsFailed() const;\r\n      std::string GetErrorMessage() const;\r\n  };\r\n  ```\r\n\r\n**Acceptance Criteria**:\r\n- All 5 command types defined and functional\r\n- Commands can be created with parameters\r\n- Commands execute over multiple frames (incremental progress)\r\n- Commands report completion/failure status\r\n\r\n#### FR-2.2: Command Implementation Details\r\n**Description**: Detailed behavior for each command type.\r\n\r\n**MOVE Command**:\r\n- **Parameters**: `Vec3 direction`, `float duration`\r\n- **Behavior**:\r\n  - Normalize direction vector\r\n  - Set agent velocity = direction * AGENT_MOVE_SPEED\r\n  - Continue for `duration` seconds\r\n  - Stop movement when complete (velocity = 0)\r\n- **Failure Conditions**: None (always completes after duration)\r\n\r\n**MINE Command**:\r\n- **Parameters**: `IntVec3 blockCoords`\r\n- **Behavior**:\r\n  - Raycast from agent position to block (check if within reach, max 6 blocks)\r\n  - Apply mining progress over time (reuse player mining logic from A7-Core)\r\n  - When progress reaches 1.0, break block:\r\n    - Remove block from world (set to AIR)\r\n    - Spawn ItemEntity with block drop\r\n    - Add item to agent inventory (if space available)\r\n  - Tool durability decreases if agent holding tool in selected hotbar slot\r\n- **Failure Conditions**:\r\n  - Block out of reach (> 6 blocks distance)\r\n  - Block already AIR (invalid target)\r\n  - Agent moved too far during mining (> 7 blocks)\r\n\r\n**PLACE Command**:\r\n- **Parameters**: `IntVec3 blockCoords`, `uint16_t blockType`\r\n- **Behavior**:\r\n  - Check if block item in agent inventory (selected hotbar slot)\r\n  - Raycast for placement position (adjacent to target, reuse player placement logic)\r\n  - Check placement validity (not occupied, within reach, not inside agent)\r\n  - Place block in world\r\n  - Consume 1 item from agent inventory\r\n  - Update chunk mesh\r\n- **Failure Conditions**:\r\n  - No block item in selected hotbar slot\r\n  - Position occupied by solid block\r\n  - Out of reach (> 6 blocks distance)\r\n  - Agent intersects placed block position\r\n\r\n**CRAFT Command**:\r\n- **Parameters**: `uint16_t recipeID`\r\n- **Behavior**:\r\n  - Look up recipe in RecipeRegistry\r\n  - Check if agent inventory has required ingredients\r\n  - Place ingredients in agent's internal crafting grid (2×2)\r\n  - Match recipe (reuse A7-UI crafting logic, if available, or implement simplified version)\r\n  - Craft item, consume ingredients, add output to inventory\r\n- **Failure Conditions**:\r\n  - Invalid recipe ID\r\n  - Missing ingredients in inventory\r\n  - Inventory full (cannot add output)\r\n\r\n**WAIT Command**:\r\n- **Parameters**: `float duration`\r\n- **Behavior**:\r\n  - Idle for `duration` seconds\r\n  - No movement, no actions\r\n- **Failure Conditions**: None (always completes after duration)\r\n\r\n**Acceptance Criteria**:\r\n- All 5 commands work as specified\r\n- Failure conditions handled gracefully (log error, return failure status)\r\n- Commands integrate with existing A7-Core systems (mining, placement, inventory)\r\n\r\n---\r\n\r\n### FR-3: Agent Vision System\r\n\r\n#### FR-3.1: AgentVision Class\r\n**Description**: Agents can query nearby blocks and entities.\r\n\r\n**Requirements**:\r\n- **Vision Range**: Default 10 blocks (configurable per agent)\r\n- **Block Vision**:\r\n  ```cpp\r\n  struct BlockInfo\r\n  {\r\n      IntVec3 coords;        // World block coordinates\r\n      uint8_t blockType;     // Block type index\r\n      float distance;        // Distance from agent\r\n  };\r\n\r\n  std::vector<BlockInfo> GetNearbyBlocks(float radius);\r\n  ```\r\n  - Returns all blocks within sphere around agent\r\n  - Sorted by distance (nearest first)\r\n  - Includes block type, coordinates, distance\r\n- **Entity Vision**:\r\n  ```cpp\r\n  struct EntityInfo\r\n  {\r\n      uint64_t entityID;     // Entity unique ID\r\n      eEntityType type;      // PLAYER, AI_AGENT, ITEM_ENTITY\r\n      Vec3 position;         // World position\r\n      float distance;        // Distance from agent\r\n  };\r\n\r\n  std::vector<EntityInfo> GetNearbyEntities(float radius);\r\n  ```\r\n  - Returns all entities within sphere around agent\r\n  - Sorted by distance (nearest first)\r\n  - Includes entity type, position, distance\r\n- **Vision Caching**:\r\n  - Update vision data every 0.5 seconds (not every frame)\r\n  - Cache results in `m_cachedBlocks`, `m_cachedEntities`\r\n  - Improves performance with many agents\r\n\r\n**Acceptance Criteria**:\r\n```cpp\r\nstd::vector<BlockInfo> blocks = agent->GetNearbyBlocks(10.0f);\r\n// Returns all blocks within 10-block sphere\r\n// Example: [{coords: (100,100,70), type: STONE, distance: 2.3}, ...]\r\n\r\nstd::vector<EntityInfo> entities = agent->GetNearbyEntities(10.0f);\r\n// Returns all entities within 10-block sphere\r\n// Example: [{id: 42, type: PLAYER, pos: (98,102,71), distance: 3.1}, ...]\r\n```\r\n\r\n#### FR-3.2: Vision Data Exposure to KADI\r\n**Description**: Expose agent vision to KADI broker via WebSocket.\r\n\r\n**Requirements**:\r\n- **JSON Serialization**:\r\n  - BlockInfo → JSON: `{\"coords\": [100,100,70], \"blockType\": \"stone\", \"distance\": 2.3}`\r\n  - EntityInfo → JSON: `{\"id\": 42, \"type\": \"player\", \"position\": [98,102,71], \"distance\": 3.1}`\r\n- **KADI Tool**: `SimpleMiner_Get_Agent_Vision(agentID)`\r\n  - Returns vision data as JSON\r\n  - Includes both blocks and entities\r\n  - Updated via vision cache (0.5s intervals)\r\n\r\n**Acceptance Criteria**:\r\n- KADI tool returns vision data in JSON format\r\n- Vision data updates periodically (not stale)\r\n- Multiple agents have separate vision data\r\n\r\n---\r\n\r\n### FR-4: KADI WebSocket Integration (KADIWebSocketSubsystem)\r\n\r\n#### FR-4.1: KADIWebSocketSubsystem Integration\r\n**Description**: Expose SimpleMiner game state to KADI broker via WebSocket.\r\n\r\n**Requirements**:\r\n- **Use Existing KADIWebSocketSubsystem**: `C:\\p4\\Personal\\SD\\Engine\\Code\\Engine\\Network\\KADIWebSocketSubsystem.hpp`\r\n- **Reference ProtogameJS3D**: `C:\\p4\\Personal\\SD\\ProtogameJS3D` (implementation example)\r\n- **WebSocket Server**:\r\n  - Run on localhost:port (KADI broker connects)\r\n  - Non-blocking communication (don't freeze game)\r\n  - JSON-RPC 2.0 protocol\r\n- **Tool Registration**:\r\n  - Register 7 MCP tools with KADI broker on startup\r\n  - Tools use PascalCase_With_Underscores naming (per user request)\r\n  - Each tool has name, description, parameters, return type\r\n\r\n**MCP Tools** (PascalCase_With_Underscores):\r\n1. `SimpleMiner_Spawn_Agent(name: string, x: float, y: float, z: float) → agentID: uint64`\r\n2. `SimpleMiner_Move_Agent(agentID: uint64, dirX: float, dirY: float, dirZ: float, duration: float)`\r\n3. `SimpleMiner_Mine_Block(agentID: uint64, x: int, y: int, z: int)`\r\n4. `SimpleMiner_Place_Block(agentID: uint64, blockType: string, x: int, y: int, z: int)`\r\n5. `SimpleMiner_Get_Agent_Vision(agentID: uint64) → {blocks: BlockInfo[], entities: EntityInfo[]}`\r\n6. `SimpleMiner_Get_Agent_Inventory(agentID: uint64) → {slots: ItemStack[]}`\r\n7. `SimpleMiner_Craft_Item(agentID: uint64, recipeID: uint16)`\r\n\r\n**Protocol Example**:\r\n```json\r\n{\r\n  \"jsonrpc\": \"2.0\",\r\n  \"method\": \"tools/call\",\r\n  \"params\": {\r\n    \"name\": \"SimpleMiner_Spawn_Agent\",\r\n    \"arguments\": {\r\n      \"name\": \"MinerBot\",\r\n      \"x\": 100,\r\n      \"y\": 100,\r\n      \"z\": 70\r\n    }\r\n  },\r\n  \"id\": 1\r\n}\r\n\r\n// Response:\r\n{\r\n  \"jsonrpc\": \"2.0\",\r\n  \"result\": {\r\n    \"agentID\": 1234567890\r\n  },\r\n  \"id\": 1\r\n}\r\n```\r\n\r\n**Reference Files**:\r\n- `C:\\p4\\Personal\\SD\\Engine\\Code\\Engine\\Network\\KADIWebSocketSubsystem.hpp`\r\n- `C:\\p4\\Personal\\SD\\ProtogameJS3D` (implementation example)\r\n\r\n**Acceptance Criteria**:\r\n- SimpleMiner registers 7 MCP tools with kadi-broker\r\n- Claude Desktop can discover tools via `/mcp` command\r\n- Calling tools from Claude executes in-game actions\r\n- Tool results return to Claude (success/failure, data)\r\n\r\n#### FR-4.2: Tool Implementation Details\r\n**Description**: Detailed behavior for each KADI MCP tool.\r\n\r\n**SimpleMiner_Spawn_Agent**:\r\n- Create new AIAgent entity at specified coordinates\r\n- Assign unique agentID\r\n- Add to world entity list\r\n- Return agentID in JSON response\r\n\r\n**SimpleMiner_Move_Agent**:\r\n- Find agent by agentID\r\n- Create MOVE command with parameters\r\n- Add to agent command queue\r\n- Return success/failure status\r\n\r\n**SimpleMiner_Mine_Block**:\r\n- Find agent by agentID\r\n- Create MINE command with block coordinates\r\n- Add to agent command queue\r\n- Return success/failure status\r\n\r\n**SimpleMiner_Place_Block**:\r\n- Find agent by agentID\r\n- Resolve blockType string to BlockRegistry ID\r\n- Create PLACE command with parameters\r\n- Add to agent command queue\r\n- Return success/failure status\r\n\r\n**SimpleMiner_Get_Agent_Vision**:\r\n- Find agent by agentID\r\n- Retrieve cached vision data (blocks, entities)\r\n- Serialize to JSON\r\n- Return vision data\r\n\r\n**SimpleMiner_Get_Agent_Inventory**:\r\n- Find agent by agentID\r\n- Retrieve agent inventory (36 slots)\r\n- Serialize to JSON (include itemID, quantity, durability)\r\n- Return inventory data\r\n\r\n**SimpleMiner_Craft_Item**:\r\n- Find agent by agentID\r\n- Create CRAFT command with recipeID\r\n- Add to agent command queue\r\n- Return success/failure status\r\n\r\n**Error Handling**:\r\n- Invalid agentID → Return error: \"Agent not found\"\r\n- Invalid blockType → Return error: \"Unknown block type\"\r\n- Invalid recipeID → Return error: \"Unknown recipe\"\r\n- Agent out of reach → Return error: \"Target out of reach\"\r\n\r\n**Acceptance Criteria**:\r\n- All 7 tools work as specified\r\n- Error conditions return clear error messages\r\n- Tools integrate with agent command system\r\n- JSON serialization works correctly\r\n\r\n---\r\n\r\n### FR-5: TypeScript Agent Framework\r\n\r\n#### FR-5.1: MinerAgent Example\r\n**Description**: Create example agent behavior in Agent_TypeScript project (deployed on DigitalOcean).\r\n\r\n**Requirements**:\r\n- **MinerAgent.ts**:\r\n  - Spawn at specified coordinates\r\n  - Call `SimpleMiner_Get_Agent_Vision` to scan for stone blocks\r\n  - Find nearest stone block within vision range\r\n  - Call `SimpleMiner_Move_Agent` to navigate toward stone\r\n  - Call `SimpleMiner_Mine_Block` to mine stone\r\n  - Wait for mining completion (poll or callback)\r\n  - Call `SimpleMiner_Get_Agent_Inventory` to verify item collected\r\n  - Return to start position (call `SimpleMiner_Move_Agent` back)\r\n  - Report completion to Claude Desktop\r\n- **Agent Utilities**:\r\n  - `pathfinding.ts`: Simple greedy pathfinding (move toward target, avoid obstacles)\r\n  - `inventory.ts`: Query inventory, find item by type\r\n  - `vision.ts`: Query vision, find block by type, sort by distance\r\n- **Deployed on DigitalOcean** (user already has infrastructure)\r\n\r\n**Acceptance Criteria**:\r\n```typescript\r\n// From Claude Desktop:\r\n\"Spawn a miner agent at (100, 100, 70) and mine 10 stone blocks\"\r\n\r\n// MinerAgent.ts executes autonomously:\r\nconst agentID = await SimpleMiner_Spawn_Agent(\"MinerBot\", 100, 100, 70);\r\nfor (let i = 0; i < 10; i++) {\r\n    const vision = await SimpleMiner_Get_Agent_Vision(agentID);\r\n    const stoneBlock = vision.blocks.find(b => b.blockType === \"stone\");\r\n    await SimpleMiner_Move_Agent(agentID, ...calculateDirection(stoneBlock));\r\n    await SimpleMiner_Mine_Block(agentID, stoneBlock.coords);\r\n}\r\n// Claude receives: \"MinerBot mined 10 stone blocks successfully\"\r\n```\r\n\r\n#### FR-5.2: BuilderAgent Example\r\n**Description**: Create building agent behavior in Agent_TypeScript project.\r\n\r\n**Requirements**:\r\n- **BuilderAgent.ts**:\r\n  - Given list of block coordinates and types (e.g., \"build a wall\")\r\n  - For each block in list:\r\n    - Call `SimpleMiner_Get_Agent_Inventory` to check for block item\r\n    - If missing, report error (or mine resources first, stretch goal)\r\n    - Call `SimpleMiner_Move_Agent` to navigate near placement position\r\n    - Call `SimpleMiner_Place_Block` to place block\r\n    - Wait for placement completion\r\n  - Report completion when all blocks placed\r\n\r\n**Acceptance Criteria**:\r\n```typescript\r\n// From Claude Desktop:\r\n\"Spawn a builder agent and build a 5×5 platform at (110, 110, 70)\"\r\n\r\n// BuilderAgent.ts executes autonomously:\r\nconst agentID = await SimpleMiner_Spawn_Agent(\"BuilderBot\", 110, 110, 70);\r\nconst platform = generatePlatformBlocks(5, 5, 110, 110, 70, \"stone\");\r\nfor (const block of platform) {\r\n    await SimpleMiner_Move_Agent(agentID, ...calculateDirection(block));\r\n    await SimpleMiner_Place_Block(agentID, block.type, ...block.coords);\r\n}\r\n// Claude receives: \"BuilderBot built 25-block platform successfully\"\r\n```\r\n\r\n---\r\n\r\n## Non-Functional Requirements\r\n\r\n### NFR-1: Performance\r\n- **Target FPS**: 60 FPS sustained with 3-10 active agents\r\n- **Agent Update**: < 0.5ms per agent per frame (total < 5ms for 10 agents)\r\n- **Vision Caching**: Update every 0.5s (reduce CPU load)\r\n- **WebSocket**: Non-blocking (don't freeze game on KADI calls)\r\n\r\n### NFR-2: Memory\r\n- **AIAgent**: < 1KB per agent (Inventory = 216 bytes, queue = variable)\r\n- **Vision Cache**: < 10KB per agent (100 blocks × 20 bytes + 10 entities × 40 bytes)\r\n\r\n### NFR-3: Usability (Minecraft Standard)\r\n- **Agent Rendering**: Distinct color, name tag visible (debug friendly)\r\n- **Command Feedback**: Clear error messages for failed commands\r\n- **Claude Integration**: Tools discoverable via `/mcp`, well-documented\r\n\r\n### NFR-4: Extensibility\r\n- **Command System**: Easy to add new commands (extend enum, implement Execute/IsComplete)\r\n- **Vision System**: Easy to extend with new queries (e.g., GetBlocksOfType)\r\n- **KADI Tools**: Easy to add new MCP tools (register with KADIWebSocketSubsystem)\r\n\r\n### NFR-5: Code Quality\r\n- **SOLID Principles**: AIAgent has single responsibility (command execution)\r\n- **DRY**: Reuse player mining/placement logic (no duplication)\r\n- **KISS**: Simple command queue (no complex behavior trees for A7)\r\n- **YAGNI**: Command execution only (defer goal-based AI to future)\r\n\r\n---\r\n\r\n## Constraints and Assumptions\r\n\r\n### Technical Constraints\r\n1. **Windows Only**: No cross-platform support required\r\n2. **Single-threaded Gameplay**: Agent updates on main thread\r\n3. **KADI Broker**: Must connect to existing `C:\\p4\\Personal\\SD\\kadi\\kadi-broker` instance\r\n4. **KADIWebSocketSubsystem**: Must use existing Engine module\r\n\r\n### Assumptions\r\n1. **A7-Core Complete**: Inventory, mining, placement systems functional\r\n2. **KADI Broker Running**: Assumes `kadi-broker` started separately (not embedded)\r\n3. **Claude Desktop Available**: User has Claude Desktop or Claude Code with KADI MCP server configured\r\n4. **DigitalOcean Deployment**: Agent_TypeScript already deployed and accessible\r\n\r\n---\r\n\r\n## Success Criteria\r\n\r\n### Minimum Viable Product (MVP)\r\n**These features MUST work for A7-AI completion**:\r\n\r\n1. ✅ AIAgent entity spawns at coordinates (3 agents minimum)\r\n2. ✅ Agent command system works (MOVE, MINE, PLACE, WAIT)\r\n3. ✅ Agent vision system returns nearby blocks and entities\r\n4. ✅ KADI WebSocket integration (7 MCP tools registered)\r\n5. ✅ Claude Desktop can discover and call tools\r\n6. ✅ Agents execute commands autonomously (command queue processing)\r\n7. ✅ TypeScript MinerAgent example works (mine 10 stone blocks)\r\n\r\n**Demo Scenario**:\r\n```\r\n1. Start SimpleMiner, connect to kadi-broker\r\n2. From Claude Desktop: \"/mcp\" (discover SimpleMiner tools)\r\n3. From Claude Desktop: \"Spawn a miner agent at (100, 100, 70)\"\r\n4. Agent appears in game (blue cube, name tag \"MinerBot\")\r\n5. From Claude Desktop: \"Mine 5 stone blocks\"\r\n6. Agent scans for stone, moves toward it, mines block\r\n7. Agent inventory fills with stone items (visible if agent had UI)\r\n8. Claude Desktop receives: \"Mined 5 stone blocks successfully\"\r\n9. From Claude Desktop: \"Spawn builder agent and place 10 stone blocks in a line\"\r\n10. BuilderAgent spawns, places blocks sequentially\r\n```\r\n\r\n### Stretch Goals (Nice-to-Have)\r\n**These features are bonus, not required**:\r\n\r\n- ⭐ Pathfinding (A* algorithm for MOVE command)\r\n- ⭐ 10 concurrent agents working together\r\n- ⭐ Agent-agent cooperation (shared task queue)\r\n- ⭐ Complex TypeScript behaviors (resource gathering, base building)\r\n- ⭐ Agent debug visualization (command queue, vision sphere, velocity vectors)\r\n- ⭐ CRAFT command fully implemented (may defer if too complex)\r\n\r\n---\r\n\r\n## Dependencies\r\n\r\n**A7-Core Systems** (REQUIRED):\r\n1. **Registry<T>**: Block and Item registries for tool parameter resolution\r\n2. **ItemStack**: Data structure for inventory representation\r\n3. **Inventory**: 36-slot inventory system (agents have same inventory as player)\r\n4. **Mining Mechanics**: Reuse for MINE command\r\n5. **Placement Mechanics**: Reuse for PLACE command\r\n6. **Entity System**: Extend for AIAgent physics\r\n\r\n**Engine Systems**:\r\n1. **KADIWebSocketSubsystem**: WebSocket communication with kadi-broker\r\n2. **JSON Library**: Serialize/deserialize KADI messages (nlohmann/json)\r\n3. **Entity**: Base class for physics-enabled objects\r\n\r\n**External Dependencies**:\r\n1. **KADI Broker**: Must connect to `C:\\p4\\Personal\\SD\\kadi\\kadi-broker`\r\n2. **Agent_TypeScript**: Must work with deployed agents on DigitalOcean\r\n3. **ProtogameJS3D**: Reference for implementation patterns\r\n\r\n**A7 Spec Sequence**:\r\n- **A7-Core** (complete) → **A7-UI** (optional, not dependency) → **A7-AI** (this spec)\r\n- A7-AI depends on A7-Core (inventory, mining, placement)\r\n- A7-AI does NOT depend on A7-UI (agents use programmatic API, not UI)\r\n\r\n---\r\n\r\n## References\r\n\r\n### KADI Integration\r\n- **KADI Broker**: `C:\\p4\\Personal\\SD\\kadi\\kadi-broker`\r\n- **ProtogameJS3D**: `C:\\p4\\Personal\\SD\\ProtogameJS3D` (reference implementation)\r\n- **Agent_TypeScript**: `C:\\p4\\Personal\\SD\\Agent_TypeScript` (DigitalOcean deployment)\r\n\r\n### SimpleMiner Codebase\r\n- **Engine**: `C:\\p4\\Personal\\SD\\Engine\\Code\\Engine\\`\r\n  - `Network\\KADIWebSocketSubsystem.hpp` - KADI integration\r\n  - `ThirdParty\\json\\json.hpp` - JSON library\r\n- **SimpleMiner**: `C:\\p4\\Personal\\SD\\SimpleMiner\\Code\\Game\\`\r\n  - `Gameplay\\Player.cpp` (mining/placement logic to reuse)\r\n  - `Gameplay\\Entity.hpp` (base class for AIAgent)\r\n\r\n---\r\n\r\n**Next Steps**:\r\n1. Review and approve this requirements.md via spec-workflow\r\n2. Create design.md for A7-AI with detailed agent architecture\r\n3. After design approval, create tasks.md and begin implementation\r\n4. After A7-AI complete, Assignment 7 is COMPLETE (all 3 specs done)\r\n",
  "fileStats": {
    "size": 25460,
    "lines": 667,
    "lastModified": "2025-11-28T01:21:11.788Z"
  },
  "comments": []
}