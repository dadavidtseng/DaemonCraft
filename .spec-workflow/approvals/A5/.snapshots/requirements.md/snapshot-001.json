{
  "id": "snapshot_1763177524668_m3kfko554",
  "approvalId": "approval_1763177524645_lrdbt7ibl",
  "approvalTitle": "Assignment 5 Requirements - Rendering and Lighting",
  "version": 1,
  "timestamp": "2025-11-15T03:32:04.668Z",
  "trigger": "initial",
  "status": "pending",
  "content": "# Assignment 5: Rendering and Lighting - Requirements\r\n\r\n**Spec Name:** A5 (Assignment 5 - Rendering and Lighting)\r\n**Status:** Draft - Awaiting Approval\r\n**Created:** 2025-01-14\r\n**Assignment Due Date:** TBD\r\n**Points:** 100 total\r\n\r\n---\r\n\r\n## 1. Overview\r\n\r\n### 1.1 Purpose\r\nImplement a comprehensive volumetric lighting system for SimpleMiner that simulates both indoor (artificial) and outdoor (natural) light propagation through the voxel world. This assignment builds upon the completed Assignment 4 world generation system to add realistic lighting, hidden surface removal optimizations, and improved rendering quality.\r\n\r\n### 1.2 Background\r\nSimpleMiner currently has a fully functional procedural world generation system (Assignment 4) with:\r\n- 16 biome types with 6D noise-based generation\r\n- 3D density-based terrain with caves and carvers\r\n- Tree placement and surface feature generation\r\n- Chunk-based world management with multi-threading\r\n\r\nAssignment 5 extends this foundation by adding:\r\n- Per-block light influence values (indoor and outdoor)\r\n- Light propagation algorithm similar to Minecraft\r\n- Day/night cycles with dynamic sky colors\r\n- Lightning effects and glowstone flickering\r\n- Improved block interaction with raycasting\r\n- Rendering optimizations (mipmapping, hidden surface removal)\r\n\r\n### 1.3 Key Stakeholders\r\n- **Professor Forseth (Squirrel)**: Assignment grader, requires exact specification adherence\r\n- **Development Team**: Student developer implementing the system\r\n- **Engine Architecture**: Must integrate with existing multi-threaded chunk system\r\n\r\n---\r\n\r\n## 2. Goals and Success Criteria\r\n\r\n### 2.1 Primary Goals\r\n1. **Volumetric Lighting System**: Implement dual light influence maps (indoor/outdoor) with propagation algorithm\r\n2. **Visual Quality**: Achieve realistic lighting effects with fog, day/night cycles, and atmospheric effects\r\n3. **Performance**: Maintain 60 FPS in Release build during chunk activation/deactivation\r\n4. **Block Interaction**: Improve digging/placing with accurate raycasting and visual feedback\r\n5. **Rendering Optimization**: Implement complete hidden surface removal and texture mipmapping\r\n\r\n### 2.2 Success Metrics\r\n\r\n| Metric | Target | Priority |\r\n|--------|--------|----------|\r\n| **Frame Rate** | ≥60 FPS (Release, during chunk operations) | Critical |\r\n| **Light Propagation Speed** | All dirty lights resolved per frame | Critical |\r\n| **Block Data Size** | Exactly 3 bytes per block | Critical |\r\n| **Hidden Surface Removal** | Complete removal at chunk boundaries | High |\r\n| **Raycast Accuracy** | Correct block/face detection within 8m | High |\r\n| **Visual Quality** | Smooth lighting gradients, no artifacts | High |\r\n| **Day/Night Cycle** | Smooth color transitions, correct timing | Medium |\r\n\r\n### 2.3 Out of Scope\r\n- Volumetric lighting (fog with depth)\r\n- Real-time global illumination\r\n- Shadow mapping or shadow volumes\r\n- Colored light sources (only white outdoor, warm indoor)\r\n- Torch entities (only glowstone blocks for this assignment)\r\n- Advanced post-processing effects\r\n\r\n---\r\n\r\n## 3. User Stories and Requirements\r\n\r\n### 3.1 Lighting System (Core Functionality)\r\n\r\n#### US-A5-001: Dual Light Influence Maps\r\n**As a** player\r\n**I want** blocks to store both indoor and outdoor light values\r\n**So that** I can see realistic lighting from both sunlight and artificial sources\r\n\r\n**Acceptance Criteria:**\r\n- Each block stores outdoor light influence (0-15) in high nibble\r\n- Each block stores indoor light influence (0-15) in low nibble\r\n- Total block size remains exactly 3 bytes (type + lighting + flags)\r\n- Light values accessible via inline Get/Set methods\r\n- EARS: WHEN a glowstone is placed, THEN its indoor light influence is set to 15\r\n\r\n**Priority:** Critical\r\n**Effort:** 5 story points\r\n\r\n---\r\n\r\n#### US-A5-002: Block Bit Flags\r\n**As a** developer\r\n**I want** blocks to store essential state flags efficiently\r\n**So that** lighting and rendering algorithms can query block properties quickly\r\n\r\n**Acceptance Criteria:**\r\n- Block has third byte storing up to 8 bit flags\r\n- BLOCK_BIT_MASK_IS_SKY: Non-opaque with no opaque blocks above\r\n- BLOCK_BIT_MASK_IS_LIGHT_DIRTY: Currently in dirty light queue\r\n- BLOCK_BIT_MASK_IS_FULL_OPAQUE: Blocks light, visibility, hides neighbor faces\r\n- BLOCK_BIT_MASK_IS_SOLID: Physics collisions enabled\r\n- BLOCK_BIT_MASK_IS_VISIBLE: Cannot be skipped during mesh rebuilding\r\n- Simple IsXXX() and SetXXX() methods for each flag\r\n- EARS: WHEN Block::sizeof() is checked, THEN it returns exactly 3\r\n\r\n**Priority:** Critical\r\n**Effort:** 3 story points\r\n\r\n---\r\n\r\n#### US-A5-003: Light Propagation Algorithm\r\n**As a** player\r\n**I want** light to spread realistically from sources\r\n**So that** the world has natural-looking illumination\r\n\r\n**Acceptance Criteria:**\r\n- Light spreads from sources with diminishing intensity (15→14→13...→1→0)\r\n- Light propagates around corners but not through opaque blocks\r\n- Light takes highest neighbor value minus 1 (not additive)\r\n- Dirty light queue processes all changes per frame until empty\r\n- Block iterators can cross chunk boundaries for propagation\r\n- EARS: WHEN glowstone is placed underground, THEN light spreads 15 blocks in all directions before fading to 0\r\n\r\n**Priority:** Critical\r\n**Effort:** 13 story points\r\n\r\n---\r\n\r\n#### US-A5-004: Dirty Light Processing\r\n**As a** developer\r\n**I want** light changes to propagate efficiently\r\n**So that** the game remains responsive when blocks change\r\n\r\n**Acceptance Criteria:**\r\n- World maintains std::deque<BlockIterator> of dirty light blocks\r\n- Blocks never duplicated in dirty queue (checked via IS_LIGHT_DIRTY flag)\r\n- ProcessDirtyLighting() resolves all dirty blocks per frame\r\n- ProcessNextDirtyLightBlock() handles single block and propagates to neighbors\r\n- MarkLightingDirty() adds block if not already flagged\r\n- UndirtyAllBlocksInChunk() removes chunk's blocks from queue on deactivation\r\n- EARS: WHEN a light block is removed, THEN all affected neighbors become dirty and light values decrease correctly\r\n\r\n**Priority:** Critical\r\n**Effort:** 8 story points\r\n\r\n---\r\n\r\n#### US-A5-005: Chunk Light Initialization\r\n**As a** developer\r\n**I want** newly activated chunks to have correct initial lighting\r\n**So that** light propagates efficiently without marking every block dirty\r\n\r\n**Acceptance Criteria:**\r\n- Blocks default to 0 indoor and outdoor light influence\r\n- Non-opaque boundary blocks touching neighbors marked dirty\r\n- Descend each column marking SKY flag until first opaque block\r\n- Set outdoor light to 15 for all SKY blocks\r\n- Mark non-opaque non-sky horizontal neighbors of sky blocks as dirty\r\n- Light-emitting blocks marked dirty\r\n- EARS: WHEN chunk activates, THEN only edge blocks and light sources are dirty, not all 32,768 blocks\r\n\r\n**Priority:** Critical\r\n**Effort:** 8 story points\r\n\r\n---\r\n\r\n### 3.2 Rendering and Visual Quality\r\n\r\n#### US-A5-006: Hidden Surface Removal at Chunk Boundaries\r\n**As a** player\r\n**I want** no visual artifacts at chunk edges\r\n**So that** the world appears seamless\r\n\r\n**Acceptance Criteria:**\r\n- Mesh construction only for chunks with all 4 horizontal neighbors active\r\n- Chunks can be active without meshes during neighbor wait\r\n- Up to 2 chunks built per frame (closest to camera first)\r\n- Face culling considers neighbor chunk blocks\r\n- EARS: WHEN standing at chunk boundary, THEN no gaps or duplicate faces visible\r\n\r\n**Priority:** High\r\n**Effort:** 5 story points\r\n\r\n---\r\n\r\n#### US-A5-007: Texture Mipmapping\r\n**As a** player\r\n**I want** distant textures to look smooth without aliasing\r\n**So that** the game looks polished and professional\r\n\r\n**Acceptance Criteria:**\r\n- Auto-generate mipmaps for all textures\r\n- 5 mipmap levels for 32-pixel sprites\r\n- 6 mipmap levels for 64-pixel sprites\r\n- Trilinear filtering enabled\r\n- EARS: WHEN viewing distant terrain, THEN textures appear smooth without shimmering\r\n\r\n**Priority:** Medium\r\n**Effort:** 2 story points\r\n\r\n---\r\n\r\n#### US-A5-008: Vertex Color Lighting\r\n**As a** player\r\n**I want** block faces to show realistic lighting based on nearby light sources\r\n**So that** the world has depth and atmosphere\r\n\r\n**Acceptance Criteria:**\r\n- Each face vertex colored by neighbor block's light influence\r\n- Red channel: normalized outdoor light influence (0.0-1.0)\r\n- Green channel: normalized indoor light influence (0.0-1.0)\r\n- Blue channel: existing directional greyscale shading\r\n- East face lit by east neighbor, south face by south neighbor, etc.\r\n- EARS: WHEN placing glowstone, THEN nearby block faces brighten with warm (green) glow\r\n\r\n**Priority:** Critical\r\n**Effort:** 5 story points\r\n\r\n---\r\n\r\n#### US-A5-009: World Shader with Lighting\r\n**As a** player\r\n**I want** realistic lighting colors and fog effects\r\n**So that** the game feels immersive\r\n\r\n**Acceptance Criteria:**\r\n- Vertex shader passes world position to pixel shader\r\n- Pixel shader receives constant buffer with:\r\n  - Camera world position (for fog distance)\r\n  - Indoor light color (default: 255, 230, 204 warm white)\r\n  - Outdoor light color (default: 255, 255, 255 white)\r\n  - Sky color (default: 0, 0, 0, updated by day/night)\r\n  - Fog near/far distances (activation_range - 2*chunk_size, half that)\r\n- Diffuse light = DiminishingAdd(outdoor_influence * outdoor_color, indoor_influence * indoor_color)\r\n- DiminishingAdd(a, b) = 1 - (1-a)(1-b)\r\n- Final color = texel * diffuse_light * vertex_color.b, then blend with fog\r\n- EARS: WHEN in cave with glowstone, THEN faces have warm orange tint; WHEN outside at noon, THEN faces have bright white/blue tint\r\n\r\n**Priority:** Critical\r\n**Effort:** 8 story points\r\n\r\n---\r\n\r\n#### US-A5-010: Distance-Based Fog\r\n**As a** player\r\n**I want** distant chunks to fade into sky-colored fog\r\n**So that** chunk activation is masked visually\r\n\r\n**Acceptance Criteria:**\r\n- Fog color matches current sky color\r\n- Fog near distance = activation_range - (2 * chunk_size)\r\n- Fog far distance = fog_near / 2\r\n- Fog fraction = (distance - near) / (far - near), clamped [0,1]\r\n- Final blend = lerp(pixel_color, fog_color, fog_fraction * fog_max_alpha)\r\n- EARS: WHEN chunks activate at max distance, THEN they fade in from fog rather than popping in\r\n\r\n**Priority:** High\r\n**Effort:** 3 story points\r\n\r\n---\r\n\r\n### 3.3 Block Interaction\r\n\r\n#### US-A5-011: Fast Voxel Raycast\r\n**As a** player\r\n**I want** accurate block targeting with my cursor\r\n**So that** I can dig and place blocks precisely\r\n\r\n**Acceptance Criteria:**\r\n- Raycast from camera position, forward direction, 8.0 meter range\r\n- Uses Fast Voxel Raycast algorithm with BlockIterator (not world coords)\r\n- Returns GameRaycastResult3D with block and face impacted\r\n- Impacted block surface highlighted clearly (separate draw, no mesh modification)\r\n- R key toggles raycast lock for debugging\r\n- Locked raycast drawn in 3D showing hit/miss and impact position\r\n- Fresh raycast performed every frame regardless of lock state\r\n- EARS: WHEN aiming at block 5 meters away, THEN correct block and face highlighted\r\n\r\n**Priority:** High\r\n**Effort:** 8 story points\r\n\r\n---\r\n\r\n#### US-A5-012: Improved Block Digging\r\n**As a** player\r\n**I want** to dig blocks where I'm aiming\r\n**So that** I can modify terrain precisely\r\n\r\n**Acceptance Criteria:**\r\n- LMB digs block hit by raycast\r\n- Set new block type (air)\r\n- Mark block lighting dirty\r\n- Do NOT update light influences (algorithm handles it)\r\n- If block above is SKY, descend marking all non-opaque as SKY until opaque\r\n- Mark each descended block as dirty\r\n- EARS: WHEN digging through cave ceiling, THEN sunlight beam streams down to cave floor\r\n\r\n**Priority:** High\r\n**Effort:** 5 story points\r\n\r\n---\r\n\r\n#### US-A5-013: Improved Block Placement\r\n**As a** player\r\n**I want** to place blocks on surfaces I'm aiming at\r\n**So that** I can build structures precisely\r\n\r\n**Acceptance Criteria:**\r\n- RMB places block on face of impacted block\r\n- Number keys (1, 2, 3) select block type: 1=Glowstone, 2=Cobblestone, 3=ChiseledBrick\r\n- Current block type printed on screen\r\n- Set new block type\r\n- Mark block lighting dirty\r\n- Do NOT update light influences (algorithm handles it)\r\n- If replaced block was SKY and new is opaque, clear SKY and descend clearing all SKY below and marking dirty\r\n- EARS: WHEN plugging vertical mineshaft with cobblestone, THEN darkness spreads below as sunlight is blocked\r\n\r\n**Priority:** High\r\n**Effort:** 5 story points\r\n\r\n---\r\n\r\n### 3.4 Atmospheric Effects\r\n\r\n#### US-A5-014: Day and Night Cycle\r\n**As a** player\r\n**I want** realistic day/night transitions\r\n**So that** the game world feels alive and dynamic\r\n\r\n**Acceptance Criteria:**\r\n- World time stored in Clock class as days (float)\r\n- Time of day = fractional part [0,1): 0.0=midnight, 0.25=dawn, 0.5=noon, 0.75=dusk\r\n- Base time ratio: 500:1 (world:real)\r\n- Y key held: accelerate 100x (total 50,000:1 ratio)\r\n- worldTimeScale = acceleration * baseWorldTimeScale / (60*60*24)\r\n- Sky color: dark blue (20,20,40) at night (6pm-6am), lerp to light blue (200,230,255) at noon\r\n- Outdoor light color: dark blue-grey at midnight, full white during day\r\n- Sky color is clear color, not drawn geometry\r\n- No light influences change (only shader constants)\r\n- No mesh rebuilds for day/night\r\n- EARS: WHEN time passes from noon to midnight, THEN outdoor lighting gradually dims to dark blue, sky darkens, but indoor lights remain constant\r\n\r\n**Priority:** High\r\n**Effort:** 5 story points\r\n\r\n---\r\n\r\n#### US-A5-015: Lightning Strikes\r\n**As a** player\r\n**I want** occasional lightning flashes\r\n**So that** the outdoor environment feels dynamic\r\n\r\n**Acceptance Criteria:**\r\n- Use 1D Perlin noise(world_time, 9 octaves, scale=200) for lightningPerlin\r\n- Range-map lightningPerlin [0.6, 0.9] to lightningStrength [0, 1]\r\n- Lerp sky color toward white (255,255,255) by lightningStrength\r\n- Lerp outdoor light color toward white by lightningStrength\r\n- EARS: WHEN lightning occurs, THEN brief bright flash illuminates outdoor areas, then returns to normal\r\n\r\n**Priority:** Medium\r\n**Effort:** 3 story points\r\n\r\n---\r\n\r\n#### US-A5-016: Glowstone Flickering\r\n**As a** player\r\n**I want** glowstone to flicker subtly\r\n**So that** indoor lighting feels more organic\r\n\r\n**Acceptance Criteria:**\r\n- Use 1D Perlin noise(world_time, 9 octaves, scale=500) for glowPerlin\r\n- Range-map glowPerlin [-1, 1] to glowStrength [0.8, 1.0]\r\n- Indoor light color = base_indoor_color * glowStrength\r\n- EARS: WHEN near glowstone, THEN subtle flickering visible, light intensity varies between 80-100%\r\n\r\n**Priority:** Low\r\n**Effort:** 2 story points\r\n\r\n---\r\n\r\n### 3.5 Technical Infrastructure\r\n\r\n#### US-A5-017: Block Iterators Cross Chunk Boundaries\r\n**As a** developer\r\n**I want** block iterators to seamlessly cross chunk edges\r\n**So that** light propagation and raycasting work correctly\r\n\r\n**Acceptance Criteria:**\r\n- BlockIterator identifies block by (chunk, local_index)\r\n- Determine local x, y, z from block index\r\n- Handle all 6 neighbor directions (N, S, E, W, above, below)\r\n- Detect chunk boundary crossing\r\n- Select appropriate neighbor chunk\r\n- Return null/invalid iterator when no neighbor exists\r\n- Preserve coordinate bits when updating one axis\r\n- EARS: WHEN light spreads from x=15 to x=16 in chunk, THEN iterator correctly moves to x=0 in east neighbor chunk\r\n\r\n**Priority:** Critical\r\n**Effort:** 8 story points\r\n\r\n---\r\n\r\n#### US-A5-018: Glowstone and Cobblestone Blocks\r\n**As a** player\r\n**I want** glowstone and cobblestone blocks to function correctly\r\n**So that** I can create lit and unlit structures\r\n\r\n**Acceptance Criteria:**\r\n- Glowstone: solid, opaque, emits 15 indoor light\r\n- Cobblestone: solid, opaque, emits 0 light\r\n- Both can be dug and placed by player\r\n- Definitions in BlockDefinitions.xml\r\n- EARS: WHEN placing glowstone underground, THEN it illuminates 15-block radius; WHEN placing cobblestone, THEN it blocks light\r\n\r\n**Priority:** High\r\n**Effort:** 2 story points\r\n\r\n---\r\n\r\n## 4. Constraints and Assumptions\r\n\r\n### 4.1 Technical Constraints\r\n- **Engine:** Custom C++ engine with DirectX 11\r\n- **Build Tool:** MSVC v143 (Visual Studio 2022)\r\n- **Platform:** Windows 10+ x64\r\n- **Language Standard:** C++17\r\n- **Threading:** Multi-threaded chunk system (N-1 worker threads)\r\n- **Rendering:** All D3D11 operations on main thread only\r\n- **Memory:** Block size exactly 3 bytes (critical constraint)\r\n\r\n### 4.2 Performance Constraints\r\n- **Target FPS:** ≥60 FPS in Release build\r\n- **Chunk Operations:** Must maintain FPS during activation/deactivation\r\n- **Light Propagation:** Must complete all dirty lights per frame\r\n- **Mesh Rebuilding:** Max 2 chunks per frame\r\n- **Chunk Activation:** Max 5 chunks per frame (burst mode)\r\n\r\n### 4.3 Compatibility Constraints\r\n- **Assignment 4 Features:** All A4 features must continue working\r\n- **Sprite Sheets:** Must use provided sprite sheets from Canvas\r\n- **Definitions:** Cannot modify provided BlockDefinitions.xml\r\n- **Noise Functions:** Must use provided noise functions\r\n- **Reference Build:** Must match reference build functionality exactly\r\n\r\n### 4.4 Assumptions\r\n- Assignment 4 world generation is fully functional\r\n- Chunk system with multi-threading is stable\r\n- Block definition system is operational\r\n- Camera and player controls are working\r\n- ImGui debug interface is available\r\n- JobSystem for async operations is functional\r\n\r\n### 4.5 Dependencies\r\n- **External Assets:**\r\n  - Sprite sheets from Canvas (required, cannot modify)\r\n  - BlockDefinitions.xml from Canvas (required, cannot modify)\r\n  - Noise function library from Canvas\r\n\r\n- **Internal Systems:**\r\n  - Chunk system (Code/Game/Framework/Chunk.cpp/hpp)\r\n  - Block system (Code/Game/Framework/Block.cpp/hpp)\r\n  - World management (Code/Game/Gameplay/World.cpp/hpp)\r\n  - Rendering (Code/Game/Framework/App.cpp, Renderer system)\r\n  - HLSL shaders (Run/Data/Shaders/)\r\n\r\n---\r\n\r\n## 5. Non-Functional Requirements\r\n\r\n### 5.1 Performance Requirements\r\n- **NFR-001:** Maintain ≥60 FPS in Release build at 1080p with 16 chunk render distance\r\n- **NFR-002:** Light propagation completes within 16ms per frame (60 FPS budget)\r\n- **NFR-003:** Block raycast completes within 1ms\r\n- **NFR-004:** Chunk mesh rebuild completes within 8ms per chunk\r\n\r\n### 5.2 Quality Requirements\r\n- **NFR-005:** No visual artifacts at chunk boundaries (gaps, z-fighting, duplicate faces)\r\n- **NFR-006:** Smooth lighting gradients (no harsh transitions)\r\n- **NFR-007:** No texture aliasing or shimmering on distant blocks\r\n- **NFR-008:** Sky color transitions smooth and visually pleasing\r\n- **NFR-009:** Zero DirectX 11 memory leaks (verified with debug runtime)\r\n- **NFR-010:** Zero compiler warnings (any warning = -5 points)\r\n\r\n### 5.3 Maintainability Requirements\r\n- **NFR-011:** Code follows existing SimpleMiner conventions\r\n- **NFR-012:** Block lighting methods are inline for performance\r\n- **NFR-013:** Bit flag operations use idiomatic C++ patterns\r\n- **NFR-014:** Light propagation algorithm clearly commented\r\n- **NFR-015:** Shader code includes inline documentation\r\n\r\n### 5.4 Usability Requirements\r\n- **NFR-016:** All controls printed to dev console on startup\r\n- **NFR-017:** Current block type and camera mode displayed on screen\r\n- **NFR-018:** FPS counter visible in top right\r\n- **NFR-019:** Chunk debug draw shows camera chunk coords and active chunk count\r\n- **NFR-020:** Job system debug draw shows chunk state counts and job state counts\r\n\r\n---\r\n\r\n## 6. Acceptance Criteria\r\n\r\n### 6.1 Core Functionality Acceptance\r\n\r\n#### Must Have (Critical - 0 points if missing)\r\n- [ ] Block data structure exactly 3 bytes\r\n- [ ] Indoor and outdoor light influence stored in single byte (nibbles)\r\n- [ ] Block bit flags functional (sky, dirty, opaque, solid, visible)\r\n- [ ] Light propagation algorithm correctly spreads light\r\n- [ ] Light correctly propagates across chunk boundaries\r\n- [ ] Dirty light queue processes all changes per frame\r\n- [ ] Hidden surface removal complete at chunk boundaries\r\n- [ ] Texture mipmapping implemented and functional\r\n- [ ] Vertex colors reflect neighbor light influences\r\n- [ ] World shader applies lighting and fog correctly\r\n- [ ] Fast voxel raycast accurate and performant\r\n- [ ] Block digging and placing updates lighting correctly\r\n- [ ] Day/night cycle smooth and correct\r\n- [ ] Project builds without errors or warnings\r\n- [ ] Maintains 60 FPS in Release during chunk operations\r\n\r\n#### Should Have (High Priority - Major point deductions if missing)\r\n- [ ] Block iterators cross chunk boundaries correctly\r\n- [ ] Glowstone emits light (value 15)\r\n- [ ] Cobblestone blocks light\r\n- [ ] Sky blocks flagged correctly on chunk activation\r\n- [ ] Non-opaque boundary blocks marked dirty on activation\r\n- [ ] Lighting updates when blocks placed/dug\r\n- [ ] Lightning strikes implemented\r\n- [ ] Fog masks chunk activation visually\r\n- [ ] Raycast highlighting clear and visible\r\n- [ ] All controls functional and printed on startup\r\n\r\n#### Could Have (Medium/Low Priority - Minor point deductions)\r\n- [ ] Glowstone flickering effect\r\n- [ ] Raycast lock toggle for debugging\r\n- [ ] ChiseledBrick block type placeable\r\n- [ ] Enhanced visual polish\r\n\r\n### 6.2 Quality Acceptance\r\n- [ ] Zero visual artifacts (gaps, z-fighting, flickering)\r\n- [ ] Smooth lighting gradients across faces\r\n- [ ] No texture shimmering or aliasing\r\n- [ ] Clean fog transitions\r\n- [ ] Consistent performance (no stuttering)\r\n- [ ] No memory leaks (D3D11 debug runtime clean)\r\n- [ ] Code quality meets professional standards\r\n\r\n### 6.3 Submission Acceptance\r\n- [ ] Correct Perforce depot paths submitted to Canvas\r\n- [ ] All required files in Perforce\r\n- [ ] Executable files set to \"Always writable\"\r\n- [ ] Both Engine and SimpleMiner depot paths provided\r\n- [ ] No unnecessary intermediate files in Perforce\r\n- [ ] Changelist number matches submission\r\n\r\n---\r\n\r\n## 7. Risks and Mitigations\r\n\r\n| Risk | Probability | Impact | Mitigation Strategy |\r\n|------|-------------|--------|---------------------|\r\n| **Light propagation too slow** | Medium | High | Profile early; optimize dirty queue; consider spatial partitioning |\r\n| **Chunk boundary light bugs** | High | High | Implement BlockIterator crossing early; test thoroughly |\r\n| **Memory leaks in D3D11** | Medium | Critical | Use D3D11 debug runtime; validate on every test |\r\n| **FPS drops during chunk activation** | Medium | High | Profile; optimize mesh rebuilding; adjust activation rate |\r\n| **Perforce submission errors** | Low | Critical | Use depot path copy feature; buddy builds; test build from clean checkout |\r\n| **Hidden surface removal artifacts** | Medium | Medium | Test at all chunk boundaries; visualize culled faces |\r\n| **Light removal cascading performance** | High | Medium | Profile worst-case (remove light in large lit area); optimize if needed |\r\n| **Sky flag propagation bugs** | Medium | High | Unit test column descent; validate on chunk activation |\r\n\r\n---\r\n\r\n## 8. Timeline and Milestones\r\n\r\n### Phase 1: Data Structures and Infrastructure (Days 1-2)\r\n- Block class expansion to 3 bytes\r\n- Bit flag implementation\r\n- BlockIterator chunk boundary crossing\r\n- **Milestone:** Block sizeof() == 3, iterators cross chunks correctly\r\n\r\n### Phase 2: Light Propagation Core (Days 3-5)\r\n- Dirty light queue implementation\r\n- Light propagation algorithm\r\n- Chunk light initialization\r\n- **Milestone:** Single glowstone lights underground cave correctly\r\n\r\n### Phase 3: Rendering Integration (Days 6-8)\r\n- Hidden surface removal at chunk boundaries\r\n- Texture mipmapping\r\n- Vertex color lighting\r\n- World shader with lighting and fog\r\n- **Milestone:** Lit scenes render with correct colors and fog\r\n\r\n### Phase 4: Block Interaction (Days 9-10)\r\n- Fast voxel raycast implementation\r\n- Block digging with light updates\r\n- Block placement with light updates\r\n- **Milestone:** Can dig/place blocks with correct light propagation\r\n\r\n### Phase 5: Atmospheric Effects (Days 11-12)\r\n- Day/night cycle\r\n- Lightning strikes\r\n- Glowstone flickering\r\n- **Milestone:** Time progresses with smooth visual transitions\r\n\r\n### Phase 6: Testing and Polish (Days 13-14)\r\n- Performance profiling and optimization\r\n- Visual artifact fixes\r\n- Edge case testing\r\n- Cross-chunk light verification\r\n- **Milestone:** 60 FPS maintained, all features working\r\n\r\n### Phase 7: Submission (Day 15)\r\n- Perforce submission\r\n- Buddy build verification\r\n- Canvas submission\r\n- **Milestone:** Submitted on time with correct depot paths\r\n\r\n---\r\n\r\n## 9. References\r\n\r\n### Assignment Documents\r\n- `Assignment 05 - Rendering and Lighting.txt` - Primary assignment specification\r\n- `Light Propogation.txt` - Professor Forseth's lecture transcript on light propagation algorithm\r\n\r\n### Existing Codebase\r\n- `CLAUDE.md` - Project overview and Assignment 4 completion status\r\n- `Code/Game/Framework/Block.cpp/hpp` - Current block implementation (1 byte)\r\n- `Code/Game/Framework/Chunk.cpp/hpp` - Chunk and terrain generation\r\n- `Code/Game/Gameplay/World.cpp/hpp` - World management and chunk lifecycle\r\n- `Code/Game/Framework/GameCommon.hpp` - Game constants and parameters\r\n\r\n### External Resources\r\n- Fast Voxel Traversal Algorithm - Amanatides & Woo (1987)\r\n- Minecraft lighting system - inspiration for dual light maps\r\n- DirectX 11 Mipmapping - D3D11_FILTER_MIN_MAG_MIP_LINEAR\r\n\r\n---\r\n\r\n## 10. Glossary\r\n\r\n| Term | Definition |\r\n|------|------------|\r\n| **Light Influence** | Integer value 0-15 representing brightness at a block location |\r\n| **Indoor Light** | Artificial light from sources like glowstone; stored in low nibble |\r\n| **Outdoor Light** | Natural sunlight; stored in high nibble |\r\n| **Dirty Light Queue** | std::deque of BlockIterators whose light values may be incorrect |\r\n| **Sky Block** | Non-opaque block with no opaque blocks above it |\r\n| **Nibble** | 4 bits (half a byte), can store values 0-15 |\r\n| **DiminishingAdd** | Formula: 1 - (1-a)(1-b), used to combine light sources non-additively |\r\n| **Block Iterator** | Object identifying a block by (chunk pointer, local index) |\r\n| **Opaque Block** | Block that prevents light propagation and visibility |\r\n| **Solid Block** | Block that has physics collision (may or may not be opaque) |\r\n| **Fast Voxel Raycast** | Algorithm for efficiently traversing voxel grid along ray |\r\n| **Mipmap** | Pre-calculated lower resolution versions of texture for distant rendering |\r\n| **Hidden Surface Removal** | Optimization to skip rendering faces that are not visible |\r\n\r\n---\r\n\r\n## Appendix A: Rubric Breakdown\r\n\r\n| Category | Item | Points | Notes |\r\n|----------|------|--------|-------|\r\n| **General** | Block iterators | 5 | Must cross chunk boundaries correctly |\r\n| **General** | Hidden surface removal | 5 | Complete at chunk boundaries |\r\n| **General** | Mipmapping | 5 | Auto-gen with correct level counts |\r\n| **General** | Data structures and fundamentals | 15 | Block size, bit flags, light storage |\r\n| **General** | Light influence initialization and propagation | 20 | Chunk activation, dirty queue, algorithm |\r\n| **General** | World shader | 15 | Lighting, fog, constant buffers |\r\n| **General** | Digging and placing blocks | 20 | Raycast, light updates, sky propagation |\r\n| **General** | Outdoor lighting effects | 15 | Day/night, lightning, flickering |\r\n| **Deductions** | Unable to build/run | -100 | Critical failure |\r\n| **Deductions** | Compile warnings | -5 | Per issue |\r\n| **Deductions** | Unnecessary files in Perforce | -5 | Clean submission |\r\n| **First Resubmit** | Build/run failure | -20 | One-time reduced penalty (normally -50%) |\r\n\r\n**Total Points:** 100\r\n\r\n---\r\n\r\n## Appendix B: Light Propagation Algorithm Pseudocode\r\n\r\n```cpp\r\n// Chunk Activation Light Initialization\r\nvoid Chunk::InitializeLighting()\r\n{\r\n    // 1. Default all blocks to zero light\r\n    for (each block in chunk)\r\n        block.SetIndoorLight(0);\r\n        block.SetOutdoorLight(0);\r\n        block.SetIsLightDirty(false);\r\n\r\n    // 2. Mark non-opaque boundary blocks as dirty if neighbor exists\r\n    for (each boundary position)\r\n        if (neighbor_chunk exists && block.IsNonOpaque())\r\n            world.MarkLightingDirty(block_iterator);\r\n\r\n    // 3. Descend each column marking SKY flags\r\n    for (each x, y column)\r\n        for (z = MAX_Z down to 0)\r\n            if (block.IsOpaque())\r\n                break;\r\n            block.SetIsSky(true);\r\n\r\n    // 4. Set outdoor light for SKY blocks and dirty neighbors\r\n    for (each x, y column)\r\n        for (z = MAX_Z down to 0)\r\n            if (!block.IsSky())\r\n                break;\r\n            block.SetOutdoorLight(15);\r\n            // Dirty non-opaque non-sky horizontal neighbors\r\n            for (each horizontal neighbor)\r\n                if (neighbor.IsNonOpaque() && !neighbor.IsSky())\r\n                    world.MarkLightingDirty(neighbor_iterator);\r\n\r\n    // 5. Dirty light-emitting blocks\r\n    for (each block in chunk)\r\n        if (block.GetDefinition().IndoorLightEmission > 0)\r\n            world.MarkLightingDirty(block_iterator);\r\n}\r\n\r\n// Dirty Light Processing (called every frame)\r\nvoid World::ProcessDirtyLighting()\r\n{\r\n    while (!dirtyLightQueue.empty())\r\n    {\r\n        BlockIterator iter = dirtyLightQueue.pop_front();\r\n        iter.GetBlock().SetIsLightDirty(false);\r\n\r\n        // Compute correct light values\r\n        uint8_t correctIndoor = ComputeCorrectIndoorLight(iter);\r\n        uint8_t correctOutdoor = ComputeCorrectOutdoorLight(iter);\r\n\r\n        uint8_t currentIndoor = iter.GetBlock().GetIndoorLight();\r\n        uint8_t currentOutdoor = iter.GetBlock().GetOutdoorLight();\r\n\r\n        // Check if values changed\r\n        if (correctIndoor != currentIndoor || correctOutdoor != currentOutdoor)\r\n        {\r\n            // Update light values\r\n            iter.GetBlock().SetIndoorLight(correctIndoor);\r\n            iter.GetBlock().SetOutdoorLight(correctOutdoor);\r\n\r\n            // Mark chunk meshes dirty\r\n            iter.GetChunk().MarkMeshDirty();\r\n            for (each of 6 neighbor chunks)\r\n                neighbor_chunk.MarkMeshDirty();\r\n\r\n            // Propagate to neighbors\r\n            for (each of 6 neighbors)\r\n                if (neighbor.IsNonOpaque())\r\n                    MarkLightingDirty(neighbor);\r\n        }\r\n    }\r\n}\r\n\r\n// Compute correct light for a block\r\nuint8_t ComputeCorrectIndoorLight(BlockIterator iter)\r\n{\r\n    uint8_t light = 0;\r\n\r\n    // 1. Check if block emits light\r\n    light = max(light, iter.GetBlock().GetDefinition().IndoorLightEmission);\r\n\r\n    // 2. If non-opaque, check neighbors\r\n    if (!iter.GetBlock().IsOpaque())\r\n    {\r\n        for (each of 6 neighbors)\r\n            if (neighbor exists)\r\n                light = max(light, neighbor.GetBlock().GetIndoorLight() - 1);\r\n    }\r\n\r\n    return light;\r\n}\r\n\r\nuint8_t ComputeCorrectOutdoorLight(BlockIterator iter)\r\n{\r\n    uint8_t light = 0;\r\n\r\n    // 1. If SKY, outdoor light is maximum\r\n    if (iter.GetBlock().IsSky())\r\n        return 15;\r\n\r\n    // 2. If non-opaque, check neighbors\r\n    if (!iter.GetBlock().IsOpaque())\r\n    {\r\n        for (each of 6 neighbors)\r\n            if (neighbor exists)\r\n                light = max(light, neighbor.GetBlock().GetOutdoorLight() - 1);\r\n    }\r\n\r\n    return light;\r\n}\r\n\r\n// Mark block dirty (only if not already dirty and not opaque)\r\nvoid World::MarkLightingDirty(BlockIterator iter)\r\n{\r\n    Block& block = iter.GetBlock();\r\n\r\n    // Only mark if non-opaque and not already dirty\r\n    if (!block.IsOpaque() && !block.IsLightDirty())\r\n    {\r\n        dirtyLightQueue.push_back(iter);\r\n        block.SetIsLightDirty(true);\r\n    }\r\n}\r\n```\r\n\r\n---\r\n\r\n**End of Requirements Document**\r\n",
  "fileStats": {
    "size": 31568,
    "lines": 812,
    "lastModified": "2025-11-15T03:29:32.089Z"
  },
  "comments": []
}