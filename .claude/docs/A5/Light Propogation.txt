Okay. Yeah.
0:01
Okay, so here are two chunks. And the easiest way to.
0:06
Hey, dude. Hold on. Uh, the easiest way for for me, for most 3D algorithms is to ask, uh, to understand them is ask is it basically the same in 2D?
0:11
And if so, I want to work it through on paper or in Excel or something in 2D and get a really good sense of it.
0:21
So. So we're going to make some two chunks here. We'll put them together, uh, here in a minute.
0:27
Uh, when they, when we're talking about touching and spreading light from chunk to chunk.
0:32
But let's just focus on one chunk and we'll talk about the data and how this works.
0:37
So I'm going to say that the top half of the chunk is all sky.
0:42
Let's say it's just like that. And the bottom half of the chunk is kind of all dirt.
0:45
So that's maybe dirt. Uh, but I might have, like, cave or, uh, a lower part here.
0:51
I may have stuff that's coming up out of the ground.
0:58
This. Maybe this is like a tree. Uh, and it's okay that, um.
1:01
It doesn't really matter whether it's, you know, a piece of dirt or a piece of stone.
1:08
As long as it's opaque, it blocks light.
1:13
And so from light's point of view, there's just opaque meaning blocks light cannot enter, and non opaque which is blocks light can enter.
1:15
And that's it. So we just have opaque and not opaque. And remember opaque is not the same as solid right.
1:24
Glass is solid but it lets light through. So it's not opaque and fog is opaque.
1:30
It might block light but it's not solid. You can still go through.
1:36
So here let's make kind of a little cave down here.
1:41
Okay. So that's our chunk. And so we want to say every block has a light influence value.
1:46
And so these are these are just going to be heat maps. Um and remember again heat map just means a number.
1:54
What does the number mean here. Let's put it uh. Make that number big enough.
2:01
Too big. Good enough.
2:11
Okay. So that number is going to be the light influence.
2:18
And so when we say a distance field remember we had oh I need to go boom.
2:22
Um. So when we had distance fields, it was a zero.
2:28
And then ones would go out from there and twos and so on.
2:32
Right. And so they naturally spread in a at least a north south,
2:35
east west grid in this diamond like pattern, because the number was the taxicab distance away.
2:40
Right. The Manhattan distance. So distance field we start at zero and count up an influence map.
2:46
So this is distance field.
2:52
An influence map is just one where the number starts up and counts down like this.
2:56
So this is just saying how much influence something has where your influence fades as you go away.
3:03
And so this could be, if you think of this as politics, like if this is the center of your capital in the city,
3:10
right near the capital, maybe you're strongly affected by the politics.
3:18
But like in Russia, if you go to the, um, to, uh.
3:21
Vladivostok in the Far East like it's near Japan.
3:27
It's nine time zones away from Moscow. They can do whatever the [INAUDIBLE] they want, basically.
3:31
So it's like, very culturally different than than, uh, Central Russia.
3:36
Right? So that there's a influence map of Moscow has a strong influence.
3:40
And then as you go away from Moscow, it loses its ability to sort of keep a handle on everything.
3:45
And so we're going to use an influence map. Instead of a distance field.
3:51
But it's essentially the same thing, right. It's just counting down instead of counting up.
3:59
An important difference is with the influence map if it counts down.
4:04
Um, so let's go do five. Influence to to to to to to to.
4:09
Okay. Now I'm done. Everywhere else is going to be zero.
4:22
And so the one of the biggest differences of an influence map counting down instead of counting up.
4:26
And it's not really that important difference. But is that conceptually you hit zero and then you have no influence from there on out.
4:32
With our distance field, we counted up two, three, 4 or 5 six.
4:39
And either we counted kept going, or we just picked an arbitrary limit of like, hey, after 500, let's stop counting.
4:42
With an influence map, the highest value is usually chosen very carefully to say like how much strength it has,
4:50
which can influence how far it can spread before it runs out completely.
4:58
This is the simplest, most straightforward, basic type of influence map.
5:04
It's integers. There's no floats. It's counting down by one.
5:09
There's no special steps. There's no exceptions. And it gets to zero and it stops.
5:14
So this is like the classic vanilla standard influence map.
5:19
What we're going to be doing is saying there's a light influence map, which is saying how much this square is lit up by the outdoor lighting,
5:24
for example, we're going to have two completely separate influence maps.
5:35
So we're going to have one which is 54321, how much outdoor lighting you have,
5:40
but another one which might be 32111, two three of how much indoor lighting you have.
5:45
So technically what we would see is two different copies of this for the same chunk.
5:51
Uh. Let's see. Can I do something like that?
5:59
Good. So this might be the outdoor.
6:02
Light influence map versus the indoor light influence map.
6:10
So we're actually try to here. I'll just, uh, I'll do it like this.
6:14
Indoor light. Uh.
6:21
And that's the outdoor. Okay, so if I say something has outdoor light influence.
6:30
And so I'm going to simplify from our Minecraft a lot.
6:40
First of all I'm saying it's 2D instead of 3D.
6:43
Second of all, for the purposes of this conversation I'm just going to talk about indoor light only first,
6:46
and then we'll talk about outdoor light separately. So we could just say there's just light, right?
6:52
If we wanted to say, hey, there's outdoor light. Outdoor makes you bright and glow stands make you bright and it's just daytime all the time.
6:58
Then we would just use one influence map for both for just light of all kinds.
7:05
So if I just called this, um. Um. So let's just say, hey, there's only one type of light.
7:11
There's not indoor and outdoor, there's only there's two ones.
7:22
So I'm also going to further simplify it and say that the brightest light that we have is nine.
7:26
Just to make it easy to draw stuff and read it in Excel, in practice, the actual highest value we're going to use is 15.
7:32
And there's a reason for that, which we'll see in a minute.
7:40
So if this is our light, uh, influence map, let's start by saying, okay, this is an all in under underground scene.
7:43
So there's no skylights. So we'll just get rid of the idea of there is no outdoor light anyway.
7:54
It's just dwarves living underground. So everything is zero by default, right?
7:59
In fact, we're just going to go boom.
8:05
Whoops. Are you change hotkeys?
8:09
It's still fun. Okay, so everything has zeros and only light sources will have something other than zero.
8:16
And so let's say that this is a glowstone here. So I'm going to use a different color for glowstone.
8:25
Um okay. So the way we should see this is the glowstone will have a light value of nine inside itself.
8:30
It's glowing internally. And then its neighbors are going to be lit up as eight.
8:37
Uh, let me do a quick rule. Conditional formatting.
8:44
New rule. Uh, based on their values.
8:49
Values that contains value. Value equal to zero is now formatted as a different color.
8:53
Right. So the zeros will be no posts. Okay.
9:08
So the way we would expect this light to propagate is going to be like this.
9:12
We're saying the light spreads out. So if you're a nine then you get one less as you go to your neighbors.
9:16
So that'll be eight on all sides of you. Except these are opaque blocks.
9:22
They're dirt or stone. So they do not accept light.
9:28
So they're going to always have a light value of zero, which means the light will not propagate into them.
9:31
So we're going to have some kind of algorithm that's going to make this spread out like this.
9:38
333322111.1.
9:42
All right. And that's what we would expect to be the, uh influence map given this one light.
9:47
Is everyone cool with that so far? You post any question or no, you just.
9:53
Okay. Okay, let's add another light source.
10:00
So now let's say I have a light source here in the ceiling. Well now that's going to have uh eight, seven six.
10:05
So this is going to get weird right. Because they're going to sort of conflict with each other.
10:13
So what we're going to say is that it's the highest of all of its influences.
10:17
We're not going to add them together.
10:23
So in this case the five next to it, this light wants it to be a one, but the light on the right wants it to be a five.
10:25
So the light on the right wins. The four is the higher values.
10:32
So we're going to use that. So this will be 444. Then this would be A3333.
10:37
This would then be a two and that would be one. So that would now be the light influence map for two light sources in this level.
10:45
So far, so good. Yeah. So, like, you just added, like, at least a couple of weeks to every day.
10:52
Oh, a couple of what? Everyone. Bates. We're going to have to add some data per block.
11:02
Yes. In fact, our blocks are going to end up being tripling in size.
11:08
And this time they're going to go to three bytes each year. Yes.
11:12
Yeah. We are going to be very, very, very stingy with our sizes.
11:17
So we're going to like cram bits into there and stuff. But yes, we are going to have to expand it unfortunately.
11:23
Again, this inference map is going to be for block yes or in Q4 per block per block.
11:30
Good question. So this is how much light is in the volume of that.
11:39
That voxel. Which means if I'm asking in this one by one, by one meter volume how much light is in the interior?
11:45
The answer is zero. In this volume, the answer is five.
11:53
That means that this face right here, the face between these meaning the south face of this dirt is going to be lit.
11:57
Based on the light in the space that it's pointing into.
12:07
So that's to me that we are doing some sort of chord modification as well.
12:15
Yes, but only when we change our light values.
12:21
So if you place a light block or destroy a light block, we will dirty the mesh and will have to rebuild it, because we're going to have new pca's,
12:27
because the seas are going to change, because we expressed nine, eight, seven, six, five into the vertexes in those red and green channels.
12:37
Yeah. But what's weird is this special, let's say this is like, uh, a block of, uh.
12:46
Lapis lazuli or whatever. It has a special face on the bottom side that looks like a mushroom or whatever, a crystal.
12:54
That face will be lit or not lit based on how much light is in this volume.
13:05
Of the block below it. You can see this in Minecraft and you can see this in the demo, right?
13:11
That that lighting, the lighting is propagated per.
13:17
Block from block to block to block by volume, but it is applied its visible face by face and a good again, a key example that is if I.
13:23
Lock this up. I can see on this side that block is is not very bright.
13:36
I guess you can't really see it. All right. That block is not very bright.
13:47
But if I go through the I know clip. Through the world.
13:51
That same block is very bright on this side. Yeah.
13:56
And in fact, even within a diagonal, we could have a radical difference.
14:01
Wear this. These are bright and these faces are dark.
14:11
Our darker. Yeah. So yes, when we place a block or, uh, when we place or dig any block,
14:17
we're going to actually have to rebuild the mesh anyway because we've got new verts exposed and other verts gone.
14:27
But also we're going to have changes to the vertex coloring.
14:33
If we let a bunch of light through or we blocked a bunch of light off.
14:37
And it might affect a lot of. It's not just the one we dug. That satisfy you for now.
14:41
Okay. Let's talk through some more scenarios. So if I place a light block here, what happens?
14:48
Let's talk through this. So I'm this is going to be the first time I'm going to talk through the light propagation algorithm.
14:58
But I'm going to give you the simple version.
15:04
Then we'll talk through it a second time with more complexity and then a third time with more complexity.
15:06
So the simplest version, um, is here.
15:12
Simplest version is I'm going to play some light. There.
15:16
Okay. So I place a light block, uh, or I change a block.
15:21
In this case, I'm placing a glow stone. But it turns out you can place any block type and influence lots of different light around you.
15:27
Again, you may make other light have to go around you now, or you may let light through.
15:36
We saw I could punch a hole in the ceiling and it affects the whole room, right?
15:41
With one block chain. Okay, so first I change the block type to glowstone.
15:44
And then we're going to say, as each block is going to store its current light influence value.
15:53
And again, let's pretend there's just one influence. So this its value is zero.
15:59
I am not. This is very important.
16:03
I am not going to change the light value to nine. I'm going to intentionally make it wrong.
16:06
In other words, I'm going to intentionally change it to glowstone but leave it at zero, which I know is wrong.
16:14
There's a reason for that is because we're going to have a list. And if I call these, you know, coordinates a, b, c, d, e r, I guess we have cell.
16:21
Okay. Thank you. Scroll d4.
16:31
Right. So cell D4 is now marked as dirty.
16:35
So we're going to also have some way of marking each block as being dirty lighting.
16:40
And so if I imagine that there's a list of dirty lights, here we go.
16:46
I'll make this list down here. We'll say D4 is dirty.
16:51
And this will be an actual list that we're going to maintain, and it will actually be a global list of lights.
16:59
Yeah. Um, I don't even get inside that.
17:06
You got you. Uh, so you've got to stop there.
17:09
Yep. Let me reset all that. Okay, so we have an empty dark cave.
17:13
Yes. And then now the first thing I'm going to do is place a glowstone.
17:25
So I've changed the block type to glowstone. It was air.
17:31
Now I need to mark that this block D4, not E4, is dirty.
17:36
And so I'm going to mark the block here to say, hey, this block is.
17:42
Uh, the block itself is dirty, so there will be a flag on the block, and there's going to be a list of all the dirty blocks.
17:48
Let's say a universal list. So right now there's one block in the global list which is D4.
17:56
This is going to be very similar to our open list.
18:02
If we wanted to do the like a Dijkstra algorithm or the faster version of the spreading our distance field,
18:05
but since we haven't done that, you'll see it right now. Then sometime during the frame, once per update, we're going to resolve all the lighting.
18:12
So we're going to process our lighting. So here's the step to do that.
18:21
First we're going to see are there any dirty block lights.
18:25
Meaning are there any blocks that we suspect their light influence value is wrong.
18:29
Well yes we have one. This one we placed. Great. So we now go to that block and we say, hey block, what is your light value?
18:34
It says zero. What should it be? And we're going to have some math to tell us, some logic to tell us what it should be.
18:42
But for glowstone that's easy. It should be nine.
18:48
Or at least in your code, it should be 15, we'll say. Oh, I'm a glowstone.
18:53
I'm 15. Great. So there will be a block depth field.
18:57
Now we'll add which is how much light does this block type emit?
19:01
Glowstone emits a lot. Lava emits a medium amount.
19:05
Redstone emits a very faint amount. Most blocks emit no light.
19:09
Right? Great. He says I should be a nine, but I am a zero.
19:14
If we come back and say, oh, you should be a nine, you are a zero.
19:19
You are wrong. We need to do something about it. So then we will now update the lighting for this block.
19:23
So the way we do that is set the lighting to be the correct amount that we calculated.
19:30
For now we just know glowstone is nine. And then we remove this block from the dirty list.
19:35
We say check we've handled this one. But we then add the blocks for neighbors to the dirty list.
19:41
So we now have D3 and whatever it is c4 c6 or sorry, c4, e4 and e5.
19:51
Right? So we now have four dirty blocks that are near this one.
20:04
And. One that's not dirty, and we keep going until we've processed all of our lighting that's dirty.
20:09
We're going to do this every frame. We're going to fully process all of our dirty lighting, every frame.
20:18
So this is a while. There's anything in the list. Keep going.
20:23
Think okay, there's something still in the list. So let's pick D3.
20:27
We're going to just pop the first thing off the list. And we're going to process the lighting for that block.
20:30
So this block here is D3. We say what is your current light.
20:36
Zero. What should it be. Well, yes.
20:41
So now we have to extend the rule of, well, what should it be? If you glow, then it should be at least your glow value.
20:45
But it's air so it doesn't glow, so it needs to be at least zero.
20:52
Then look at your six neighbors North, south.
20:58
East. West. Above and below. If, uh, and get the highest of those nabers light values, minus one should be at least your value.
21:01
So if you have a neighbor that's nine, you need to be at least eight.
21:14
You could also be nine if you're a glowstone. Okay.
21:19
So I. Yes, it is highest.
21:24
Yes. So we look at all six neighbors, we get the single highest neighbor, and we set ourselves to be one less than our highest neighbor.
21:28
But if one of my neighbor is D and another, and that is people from a different light source, then I'm not going to be.
21:38
You should be one less than your highest neighbor, which is eight, so you should be seven.
21:48
Meaning the second, the dimmer light has no effect on you.
21:57
But if I have two lights, then they're not in this system.
22:02
Not in this system. Yeah. So that is definitely something that's unrealistic about the system.
22:06
If you have ten lights all around you, you're going to be 99999999999.
22:11
They all want you to be eight instead of just one of them wants you to be eight.
22:16
So they're not cumulative. They don't know not additive in effect.
22:20
There are ways of doing that. But it again gets much more complicated.
22:24
Right. So we say we should be at least one less than our highest neighbor.
22:28
Therefore, we are eight. So now this one is done.
22:35
We say he's no longer dirty. And so he's removed from the dirty list.
22:38
And that was D3. Great. And now we keep processing our light.
22:44
So we say okay C4 is next. So let's process C4.
22:47
C4 is this one. What are you zero.
22:52
What should you be eight. Did you change?
22:55
So let me back up. We actually missed one thing we say for this one above we said, what are you zero?
23:00
What should you be? Eight. Okay, were you wrong?
23:07
The answer is yes, I was zero, but now I change to eight. If you were wrong and you changed, then you need to in turn dirty your neighbors.
23:11
To allow them to be possibly affected by your change.
23:22
I'm not going to update this anymore just for speed. So eight is now done.
23:27
But he says, just so you know, the people to my on sides of me.
23:32
They might be wrong now too, because I might have just gotten some light that they need to know about.
23:37
That makes sense to the blog. On top of that, you will not be adding.
23:46
I did not add this one to the dirty list because blocks that are opaque.
23:51
I checked my north south, east west above neighbor. I said hey, above neighbor, you're dirty.
23:57
And he says no, I'm opaque. I don't believe in dirty.
24:02
Oh so dirty. Opaque blocks refuse to become dirty.
24:07
In other words, light can't spread into them, so they don't.
24:14
So we won't market dirty. Yes, Jeff.
24:18
I think, you know not to be here tonight. Is that possible? Yeah.
24:22
Great question. So I would say I do read the ninth.
24:26
Yep. So are actually in this case. It's a glow stone and glow stones are opaque.
24:30
And so, like Stone, the glowstone would say, no, I don't take light.
24:37
I don't receive any light. What it's like of you.
24:42
So it's. If we go down with that, be. Yeah.
24:48
And we will have your problem. Just not yet. Yes. So let's do it.
24:52
So let's say we now do this one. Okay. Yeah. I'm sorry.
24:55
So on the big block that is above the block eight.
24:59
That block's face facing the blockage should also be willing that yes, this block is going to look differently.
25:06
Absolutely. But his internal light value will not increase.
25:16
So what we're going to see is a block, a dirt block whose bottom face is well lit, but whose internal light value is still zero.
25:21
So we have the algorithm that is running right. No, that's a great question.
25:31
We're in fact, we're not. It's kind of like when we were generating the blocks or loading the blocks from disk.
25:36
All we were worried about is is it grass, is it air?
25:41
Is it stone? We don't. There is not even a mesh to worry about.
25:44
Same with the light propagation. We're just going to do the propagation of the nines in the eights in the sevens first completely.
25:48
Then we'll go back and see if we have to fix inverts. Yeah.
25:54
So a separate pass. In practice,
25:59
what we're going to do is just dirty all the meshes that were affected and have them
26:03
rebuild their meshes and then they'll rebuild with brighter verts this time conceptually.
26:08
But we're not there yet. Okay.
26:14
So now let's see. We processed this one right. Let's say this one happens to be all the darkened ones are in the dirty list.
26:18
And so I'm going to fix this one I say what is your light zero.
26:25
What should your light be. My highest number is eight.
26:28
Minus one is seven. Did you change. Yes.
26:32
So okay. You've been updated so you're no longer dirty.
26:35
But if you changed, you need to dirty all your neighbors.
26:39
So that's going to dirty this one. And it's going to re dirty the eight potentially.
26:44
It will try to re dirty this one, but that one refuses because it's opaque.
26:50
Well, now we go to process eight. Eight says, what should it be?
26:57
Uh, and in practice, we're going to use a Q for this.
27:02
So this one will get pushed to the end of the Q. So actually here we'll go last.
27:06
So it's not as wasteful. So in practice I think this one might be next and then this one and then this one or whatever.
27:11
Actually these would be next technically. So even they would be before even this up.
27:19
Yeah. So if we then do this for example, this one it was.
27:24
What should it be? Eight. What is it? Zero. Is it wrong? Yes.
27:30
Correct it and mark it. Not dirty. And then re dirty its neighbors.
27:34
If they're not opaque. And so essentially what's going to happen is this is going to spread out.
27:40
And if we keep processing like this, eventually we're going to pick this one.
27:47
That one's going to be a seven. The seven change.
27:51
So it's no longer dirty but its neighbors have to become dirty.
27:54
And here in this moment when I read dirty, when this guy finishes,
27:58
I need to make sure that if I re dirty this one a second time, I don't want to put it in the list again.
28:03
So we're going to say everyone is in the dirty list only once for a couple of different reasons, but for now we'll say for efficiency.
28:10
In other words, I need to sort of say, hey, neighbor to my west.
28:20
I just changed, so you may want to have to check yourself again. Mark yourself dirty if you're not already dirty, and if you're not opaque.
28:24
So now the algorithm is like mark your non dirty non opaque neighbors as dirty when you update your value.
28:35
Soviet Union was once, but we could, if we clear one of them, you could read very.
28:44
You could clear and dirty at multiple times. In practice, it's going to happen very little.
28:50
So let me show you this happening step by step in 3D. So, uh, here, uh, let's.
28:58
Turn the lights off. Because you really want to see this. All right.
29:06
I'm drawing a debug draw thing for every block whose light is dirty, which is basically every block in my entire universe.
29:20
So that's going to be a lot. Um, let me run some, let me know.
29:28
Okay. This is the right Ken.
29:32
Yes. Let me finish spreading my light.
29:38
Just a minute. Get some more shots activated. Okay, so here we are.
29:42
And here we have an indoor light. And let me have a couple of indoor lights.
29:48
Okay. We have an indoor light that's casting red light in the assignment.
29:58
It will be green. And then we have this outdoor skylight that's coming in as green influence.
30:02
And this is casting both red and it's mixing with the green.
30:08
So we have some yellowish tinting around. Right. Okay, so let's go through this process of dirtying and watching the dirtying spread.
30:12
So I'm going to first dig some stuff. They remove stuff, clog up the light.
30:21
I mean, let the light propagate. So we're going to start in a completely dark room.
30:29
And now I've set it up so that the light isn't going to just update completely.
30:34
I'm going to do one pass through the lighting cue.
30:40
And then there will still be stuff dirty, but you'll be able to see the light spread more carefully that way, right.
30:42
So here I'm going to pick and place a new light.
30:47
So that is a glowstone. It is. Now that's this thing here.
30:51
When I had just placed the glowstone. But it's still zero light.
30:57
But I marked its light dirty because it's probably wrong. Right.
31:01
So you can see that little yellow dot in there. That means it's in the dirty list.
31:05
That's my debug drawer for it. It's in the dirty list. Okay.
31:09
If I hit L, it will propagate the lighting one step, meaning it just ran once through the debug.
31:13
Uh, if the dirty lighting cue and process to everyone in there, it might have pushed more people into the queue, but I stopped at that point.
31:20
The easy way to do that is to have your debug lighting cue.
31:30
If you're doing this step by step thing, which I highly recommend for debugging, you just sort of copy that cue off.
31:33
And then clear the real queue and then process through this.
31:42
And as you're processing through this, it'll push real dirty for the next round.
31:45
But then when you're done with this, you stop until you get another key.
31:50
So you can just process one though. So what do we have right now?
31:54
Nothing. No one is lit. Why?
31:57
Well, because the inside of this little hockey is lit is now bright.
32:00
But you can't really tell because there are no faces that are being lit by that.
32:04
And these outside neighbors, five of them, the one below, refused because he's okay.
32:10
They are dirty, but they haven't been updated yet, so their light values are still zero, so his faces are lit by dark neighbor air.
32:16
If I then hit l we now have. Okay.
32:25
This area not recalculated to be a light value of 14 one minus uh, maximum started at 15.
32:29
Inside there is 14 out here and 1414 within these areas.
32:38
And so those then in turn light these faces with, uh, a high amount of red light.
32:43
This is red because this is indoor lighting that we're propagating.
32:51
Well, actually bringing in some. Yeah, right. Like you said, problems with lots of things.
32:55
So the cobblestone is also going left. Lots of light accusing the accusing for poor light for its neighbors.
33:01
You mean the glowstone? Yeah, right. The cluster. Yes.
33:09
The glowstone surfaces. This surface is being lit based on how much light is in the air here.
33:13
This surface is being lit by how much is in the light of the air here, but so that it doesn't have to do that,
33:20
like, even though the ensemble is 14 is 15, 15, it's spaces are being drawn based on.
33:27
Correct. That bonding tactic is the lowest.
33:35
Sure, it's so low. That is the way we're doing it, is that it starts with a 15 in the influence map.
33:39
But the only people that will be able to see that are the people, its own faces, who are going to be lit by the air here, which is 14.
33:46
Correct.
33:55
Now later we're going to have things like a torch, which is a non opaque light source that lights itself 15 and its faces you will be able to see.
33:56
But for this one, yes, it's kind of odd. It's covering up its own brightness in a sense.
34:07
Right. There's no one to see tonight, so it's not glowing like it's crystallized who we are.
34:12
This is my neighbor, Clark, my fellow neighbor.
34:18
And without, like, his face, the faces light up.
34:23
But I did err. Yes. Hey, that's all you guys.
34:29
We got to get through this. So yes, this case is lit by air, not by glowstone.
34:35
I think that's the correct way to think about it. And this face is lit by air, not by glowstone.
34:41
Are you raising your hand? Okay. Now notice what faces do we have dirty in 3D?
34:45
We have all of the ones. This face, this block in there.
34:52
The one to the sea. The green thing on my compass is north.
34:56
So this is to the north. That is not dirty, that volume, but the ones to the south, or to the north and east and west of it.
35:01
Those are all now marked as dirty in 3D. And if I do this another step, then those will spread the 14th and this will now.
35:10
Get. Sorry. This will now get a value of 13, which then colors this surface.
35:21
And if there were a block here, it would be colored by that surface as well.
35:27
So we now have 15, 14, 13, 15, 31 around.
35:32
Yes. So with the like, let's say, for instance,
35:38
if I was generating lights with like world generated films and that light ended up with downed trees, right.
35:43
So the special case we're not. Yeah. Let's try to understand within chunk first.
35:50
And is this advertised. So let's look running that list once every frame or has it all done over and over.
35:55
For now we're going to say process all lighting every frame.
36:02
So in that sense we're not amortizing. Amortizing would mean do as much as you can and then save the the rest of the work for next frame.
36:07
No, we're going to say completely resolved the lighting every frame, only because it turns out we can do it pretty fast.
36:16
But it would look kind of cool. It would spread. Although you can have some bugs with it.
36:24
But yes, but you can easily just have it like this where someone is like spamming L and then whenever you click something,
36:29
it's going to occasionally, you know, like spread out like that, but okay.
36:37
Uh, so conceptually, for the simple case, we add a light.
36:44
We then propagate propagate, propagate. And each one is like going out and having influence on the next ones.
36:51
And eventually this influence goes out. 15, 1413 1211 ten 987654321.
36:57
And then there's no one dirty. Why?
37:05
Why does the chain reaction stop? Because at some point we're going to say six, five, four, 3 to 1, and then we'll dirty this.
37:09
And we say, what is your value? Zero.
37:20
What should it be? Well, my highest number is one. -0 is zero.
37:23
I'm correct. So I don't have to change. So then you just say, oh, you didn't have to change.
37:28
Let's just mark you not dirty and will not tell your neighbors.
37:34
So you only tell your neighbors if you did change. So eventually zero will be correct and you'll just stop telling people.
37:37
Yeah. So the lie. So it is calculated by the line value.
37:45
So I said, well I, it is eight. So we can make all those a study.
37:51
Oh we study first and then we set it to a and then we like uh detect all those neighbors that exist.
37:57
So yes. Good question. Uh, so.
38:08
That's not even the right sign. My. Uh, hold on a second.
38:15
So we mocked the derivation of the value. You market dirty, right?
38:22
So if you change, if you actually change your light value to be different, then you tell your neighbors,
38:27
yeah, hey, you should recalculate yourselves so you make your neighbors dirty.
38:36
If you change, that's the only. That's the main way we make things dirty.
38:41
The other way we make things dirty is if we, um, like, place a low stone, for example.
38:47
So I'll say this. I'll let me finish going through the algorithm and some of the details, but.
38:55
In the assignment I think I have. Dirty light processing.
39:03
While there are any block iterators in the queue, clear the block's dirty flag.
39:09
Compute its correct indoor and outdoor light. Compare that to its current light.
39:15
If either value is incorrect. Change their values to be correct.
39:21
Mark. It's neighboring blocks as being dirty, and then mark the chunk as being a dirty mash also for fixing at the end.
39:25
So there's going to be a bunch of details in the super final version, even though it is spelled out exactly in here.
39:36
Yeah. So I want to just get to like the 80% coverage of everything before we run out of time.
39:43
Yes. Right. So. Oh, why or why the light goes off the end of the shot.
39:48
It does cut off completely. Ends up with a value. But that seems like that's one reason.
39:57
But that's not the reason. But go ahead. What happened? Because the light was in the middle of the chunk.
40:02
Yep. The 15 has nothing to do with chunk size. Yeah that's right.
40:09
And if it does affect it and then the value is going to go beyond.
40:12
That's right. Then how do you calculate uh bordering on the next term.
40:16
So same as all my special. Uh, that's a special case.
40:21
We'll handle it. But yes, even if my light I said the max light value is three, it could go across that chunk border.
40:24
So, yeah, it's the light value of 15 is total coincidence that that's the same as the light.
40:32
The chunk with minus one. Not related at all.
40:37
In fact, if you change your chunk width, you're still going to use a max light value of 15.
40:41
But regardless, it can spread across the border.
40:45
So we will have to handle that as a special case, but not until we understand that the rest of the general case.
40:48
Right. So, uh, you mentioned that you love your sister.
40:55
Eat. And then you say that whenever any problems weather thing, um, they handle that, you know, and.
40:59
Like one line is the main burden. And.
41:08
Why not just do that? Check this for my.
41:12
Um, for a number of reasons.
41:18
Um, it. Becomes recursive and will.
41:21
Instead of iterative, it would become recursive. If we do it that way, which is going to be slower, like we're going to do this,
41:27
that's going to do that, that's going to do that before we're done resolving.
41:34
Um. Uh, second, it's it tends to be more cash friendly.
41:38
Uh. To do the.
41:44
Well. No.
41:49
Um. You mean why not change them as soon as we.
41:53
Instead of dirtying them, why not just fix them? Oh, I thought you'd like a deck first.
41:57
Clean. I think you mentioned that plenty of times, Kevin.
42:05
Yeah, I think the boat is dirty.
42:09
Including it. Right. And then when I leave this for.
42:13
Yes. Where the [INAUDIBLE] are you? It's late.
42:19
You're down here. Look, uh. Audience member minus one.
42:22
Right. And then based on that picture set that.
42:28
Yes. What if we. Then we're processing that in neighbors.
42:33
Yes. Just get up here.
42:40
Are you already there? Are you okay?
42:43
Hi. Use your living influence value.
42:47
Greater or less than me. Minus one. Okay, so in this case, what is the correct value for this square that I'm on?
42:51
But which one? The square that I'm on. I got it up the eighth square.
43:01
Yes. This one right here. Uh, eight.
43:09
Where is that light coming from? So that's not correct.
43:14
It should be one less than its highest neighbor. It's a long wait, but now this one's dirty.
43:21
But then by that logic, then you go to, like, um, before.
43:31
Yes. That's a glowstone. That's glowing.
43:37
Yes. So what's the correct value for that?
43:41
One less than its highest neighbor, which is eight. But we just like that.
43:45
Yes. One less than nine, which is eight.
43:50
This has no glowstone next to it. Part of the problem is you're asking about the next stage.
43:55
So let's watch that happen. So what we have is spreading light is actually relatively simple.
44:01
Removing light is very strange in an influence map.
44:08
So if I have a light that's like this, I would expect it to be stable in a form like that, right?
44:13
Seven, six, six, six, six, etc. let's say like that.
44:23
Now what happens if I destroy this glowstone? Well, first thing I'm going to do is say it's no longer glowstone, but it's still a nine.
44:28
Right. Because when we destroy something, we change its type.
44:39
But then we just market dirty. Well, now what happens?
44:43
Well, this is the only block that's dirty. Let's say ignore the top part.
44:47
So we processed this. What should its light value be?
44:53
One less than its highest neighbor, which is seven, meaning its highest neighbor is eight.
44:57
So it should be a seven instead. So this becomes a seven.
45:02
And these guys get dirty. Does that make sense?
45:06
Well, now, what happens with this guy? What should he be?
45:14
He should be one less than his hires neighbors. So he should be a six, and then he should dirty his neighbors.
45:18
And this guy, what should he be? He should be one less than his highest neighbor.
45:27
He should be a six. Then he should dirty his neighbors. So then we're going to look like this.
45:32
So I'm lower than you. Well, I'm lower than you. Well, I'm lower than you.
45:48
And we're all going to go down to zero. So if you actually watch this happen in 3D,
45:51
watch you actually see this sort of checkerboard pattern where each one is going to go lower than the other.
45:55
Oh, I'm lower than you will. Then I'm lower than you will. Then I'm even lower than you.
46:02
And you can try to optimize and avoid this.
46:06
But it's there are so many cases where you going to have other light influences that are coming in.
46:09
You need to go down to whatever that level is.
46:15
So essentially, we're letting the water drain out of the place until it reaches like the levels that it needs to be at,
46:18
which might be all the way down to zero. I think it will broaden my age.
46:26
This is my vision. You know what? We want.
46:32
No. If you do that, then nothing will happen.
46:38
Watch. This is the problem. So here I have a light and let's say.
46:43
Here, let me put it back to where I have a light here. Right.
46:48
So if this is my situation, if I say.
46:56
This light is no longer light, it's just air.
47:01
I'm going to dig it and I'm going to correct the value now.
47:05
If I don't. Uh.
47:11
Yeah. How do I say it? There are cases. I should say. There are cases where I can already be correct, and then I won't bother updating my neighbors.
47:16
Right. In this case, I would actually detect that I should be seven and that should kick off the sequence.
47:25
But I want to be wrong in order to provoke the sequence.
47:32
A better example is if I place the light block in here and I set it to nine and I market to dirty.
47:35
We process it. What should you be? Nine. What are you?
47:43
Nine. All's good. And it doesn't start the chain reaction.
47:47
So we want it to be wrong when we change it. So it sort of provokes.
47:51
And the chain reaction for reducing light ends up being a leapfrog effect of I'm lower than you,
47:55
well then you're lower than me, then I'm lower than you, then you're lower than me sort of thing.
48:00
So it's more expensive to do the holiday time. And so it actually is more expensive to remove a light than add one in this algorithm.
48:05
Again, there are ways we can get around that. But then there are.
48:14
It causes many more problem cases, which cause some more special cases and more code, which ends up actually being slower than just doing the work.
48:18
We already have like a list of the. So yes.
48:34
Making the block. That's a great question. So there's no need to dirty a block when you know you have a list.
48:38
Well, in part we want to do things like, um.
48:45
Hey, don't add this block four times to the list. There are a lot of cases where you end up with blocks that get added like six times to the list,
48:50
and the only way to prevent doing that is to either use a data structure that precludes that,
48:57
like a standard set or something, which ends up being much more expensive than what we're doing.
49:01
Or you have to search through it to the data structure to find it.
49:08
So essentially we're going to stick a single bit on the block itself to say I am in the queue,
49:12
no need to search it or this is going to be an exploit we're going to use over and over and over and over,
49:17
and lots of data structures of some amount of redundancy to say, hey, no need to go look me up in that list either.
49:22
I can tell you right now I'm not in it or I am in it. When we do a star, for example, we're going to have an open list and a closed list,
49:30
but the blocks themselves will have data to say I am, I am or am not in that list or this list.
49:36
So there's no searching, which ends up being the slow element often.
49:41
But yes, it's redundant. Totally. And it's. And the other question that's great is it's where we store that.
49:46
Is that in the block. That's in the block. So with that being in our block state of mind, it is part of our it's going to be part of our block class.
49:53
So. So and that's the last part I'll cover for today.
50:01
But let's take some last questions Alvin. Uh.
50:04
What? I think I should go and see for myself.
50:10
Yes. As different start. Well, yeah.
50:15
So let's say this is a nine, and then we have another light over here that's like, uh.
50:19
Yeah. You can. Yeah. I think that's something.
50:25
Okay. So if and let's say these are both blocks, they're opaque blocks like one is sunstone.
50:32
One is moonstone. Right. So this will these will propagate.
50:38
Then seven fruits are.
50:47
Then this one will is going to be dirty at this point.
50:52
So [INAUDIBLE] calculate this one. This guy will recalculate as seven.
50:55
So [INAUDIBLE] be correct. He didn't change. So you won't dirty his neighbors.
51:00
Um, but this one will be six.
51:04
No no, no. Oh, sorry. Otherwise, you want these?
51:09
Okay. And then. And when we changed this seven, we would have dirty this one.
51:14
You cannot be 32,035.
51:24
It's changed, but that's okay. Then. We're going too fast.
51:29
Because that's not that's not true. If that's what you what you have to do, then we have to go through it carefully.
51:33
So essentially here I'll just do it like this. So this one is incorrect.
51:39
This one's incorrect. So we mark them both dirty.
51:48
We process this one. We say you should be a nine. You were wrong.
51:52
So you need to dirty all four of your neighbors. Then we pick this one to do you want to do the other one first?
51:56
You're okay. So let's go. Like this.
52:08
This four foot to the end of the first. The second one is this.
52:13
Okay, then this one. Are you, uh. Correct. No.
52:17
You should be three. So then we need to dirty your four neighbors.
52:21
This one, we ask the block. Are you dirty? So we don't re dirty.
52:24
It so it's just still dirty. Okay, so the principle comes to.
52:28
Yes. So now let's say we do this one next.
52:32
So this one calculates. What should I be? I should be one less than my highest neighbor.
52:36
That's eight. And then I have to dirty these two people.
52:41
He started the one. And they're at the very end of the queue.
52:49
Then we would say calculate this one. What should you be?
52:55
One less than your highest neighbor. He's a two. He's been updated, so?
53:01
But he did change. So he needs to dirty all of his neighbors.
53:05
He does not dirty the three because it's opaque. So now, at some point now let's say we're going to get around to this one.
53:08
We say what is your highest neighbor? Eight so you should be a seven.
53:18
Okay, so now you are correct. And it will be dirty.
53:24
And it will dirty. Yes. All of its. Was to.
53:34
Hold on when seven gets corrected. It might affect all of its neighbors might be affected.
53:41
So we say seven is now correct and all of its neighbors are now questionable.
53:48
So all four of these have to be rechecked and eight, when it's rechecked, will say I should be eight, so it'll do nothing.
53:54
Two when it's rechecked.
54:03
Good thing we rechecked it because it was wrong, but because it has to be one less than its highest neighbor and it has a seven now.
54:05
But you have to check it. Yes, but we cleared it.
54:14
But we're dirtied it. So it went from here.
54:18
I'm doing the colors accurately here. It's two. The two is dirty when we do the two.
54:23
If you think you can be dirty.
54:29
Uh, well, if you are, uh, chatting like, to far away from, uh, like songs like, like, uh, this is a guy that's already played silent.
54:31
Let's go. You mean like this over here? Yeah, I think it's.
54:45
So now some of it's dirty. Uh uh.
54:51
Yeah. Now. So it's 30 or so. So it becomes 3000 and then.
54:55
Well wait wait wait. Who are we processing. Are we processing 6 or 7.
55:00
So we're going to say four. Well no. Is six already set like this?
55:05
It is. So.
55:11
So it sticks. It's not that if it's not set. Okay, well, wait.
55:15
We're skipping. So if we process seven, we say what should it be?
55:20
Is this is seven already set? I don't think is this dirty or is it that.
55:24
It's that it's a of then this will be six instead of.
55:29
It will be set to seven and then made not dirty. When we correct it, we make it not dirty and dirty.
55:33
The neighbors. Yeah. So now all four neighbors will become dirty.
55:42
Correct. With that. Go.
55:47
Now let's say we want to process this. So we say we're processing it.
55:53
It's no longer dirty. What should it be? It's wrong.
55:58
Therefore it's for neighbors need to be dirtied. And then we go back to seven.
56:03
We say you are dirty, so we're processing you now, so you're no longer dirty.
56:12
What should you be? Eight minus one is seven.
56:18
Are you correct? Yes. Then you're done. Don't.
56:21
So. Yes. It takes a long time to go through it carefully.
56:31
And we're rushing because we're because it would take hours to go through.
56:41
I would say go through it very slowly and carefully. Um.
56:45
So, Joe, we are going back to where it was that you're going back to check, but then you'll the check will be correct.
56:51
So it won't do anything. That's right. Yeah.
56:59
Really? Well, I don't know if it will be a spotlight removal. Um, are we only supporting one light source value for not a big walks?
57:05
Because let's say I have, like, a torch here, and then a red stone here, and I break the torch.
57:14
Wouldn't that overrule the red stones? Light value. Was it red stuff or just disappeared?
57:21
No, that's the same. So I would say, uh, think about these scenarios and try them out yourself.
57:26
But in this case, here's the torch. Here's the red stone. And so if in a stable situation, it should look like this.
57:34
Half the battle is agreeing on what the correct values should be.
57:47
Do you agree that those are the correct values? Well, wonder Redstone has a higher value.
57:54
No, no, the redstone's opaque. It does. It refuses light.
58:02
It doesn't take light into its own forge. Oh.
58:06
So sorry. Yes. So then this would be a five, and then this would be a four.
58:09
This would be three. So. Yes. Yeah, but the light doesn't have the knowledge of, like the type of lock.
58:14
That's correct. Disappear. Well.
58:21
Wait, is this correct for the stable situation? Yes. So now you're talking about would it disappear if we remove something?
58:25
Yeah. Remove the now. Yeah, but we have to go really slowly when we're doing this.
58:30
So now let's remove the nine. We'll change this.
58:34
This is useful to go through. I think this will really show. So now we change this block I just change the block type.
58:37
It's now air and it's dirty. Right.
58:44
And I'm going to do this in one knee just to make this simple. So we'll go boom boom this is the tunnel.
58:49
So now in fact there's nothing over here. Uh, no, I'll guess I'll do it one so I change mind.
58:55
So now I process this. So in processing I pop it off out of the dirty queue and I market is no longer dirty.
59:05
I calculate what is its correct value. Its product value is seven.
59:13
Does everyone agree with that? I mark it as seven.
59:17
It's now correct. I'm very confident it's correct, but I have to I changed so that might affect my neighbors.
59:21
So I dirty all my neighbors. But only one of them accepts that right?
59:28
Is everyone okay with this? Agreed. Well, now I have one dirty block, which is this eight.
59:34
I now process that. Hey! You're dirty. What should you be?
59:39
I should be a six, so. Okay, well, you were wrong, so let's fix you.
59:42
You're no longer dirty, but your neighbors. Are questionable.
59:47
So we. Let's check, recheck them. Well, now we reprocess this seven, let's say.
59:52
What should you be? I should be a five. And I have been fixed, thank God.
59:58
Now I have the right value. But that might affect my neighbors.
1:00:03
So I'm going to tell my neighbors about them. This guy is probably next in the queue.
1:00:07
He says, what should you be? I should be a five. Oh, thank goodness someone checked me.
1:00:14
I was wrong, but now I'm correct. But let me make sure my neighbors know so I would dirty the neighbor to the east.
1:00:19
And then I would try to re dirty the neighbor to the west.
1:00:26
But he would say, no thanks, I'm already dirty. So far so good.
1:00:30
We keep doing this. So this six becomes a four and then these become dirty.
1:00:35
Wish there were multiple fill things. I could just have the palette.
1:00:43
This six becomes a four. This becomes done.
1:00:48
This becomes dirty here. This one doesn't become dirty because it's opaque.
1:00:52
Oh, no. Sorry. You said it's a gloss from torch. Yeah. Okay, so this one becomes dirty.
1:00:57
So how are we marked that? Um. Like this.
1:01:01
Then we say, hey, glowstone torch, what should you be?
1:01:06
So now here's we're going to state the formal rule.
1:01:10
I should be at least a three because I'm a glowstone torch baby, and I should also be at least one less than my brightest neighbor.
1:01:13
So I'm the at least three. And my brightest neighbors are four, so I have to also be at least three.
1:01:22
So I'm going to be a three. We have to check if we're a light source.
1:01:29
If we're not on the right. Light sources are not immune to taking light in.
1:01:33
So if you think of it as the torch is like a singular spot in there that's filling its area with its air within that mostly air, that is the minimum.
1:01:38
Yes. That's right. And so then this will, then this will dirty that one which will stabilize at this.
1:01:50
This will then dirty these which, then dirty these which, then dirty these which, then dirty these.
1:01:58
But this one will go be kept to a two because of the three.
1:02:06
Then little dirty. These which are dirty. These which will dirty these.
1:02:11
But this one is correct. So he won't fix any one. This one go down to zero eventually.
1:02:15
Everyone's now correct and stable. And that's the new form and that zero.
1:02:21
Okay. And for then rent. Uh.
1:02:29
So. Why does the redstone that technically start with one of five?
1:02:32
Well, I'm feeling, as you know, every light source. He would always be constantly.
1:02:38
It was being. It was being brightly lit by the glow stone that was there before.
1:02:42
Think about it like this. I have here's my cell phone.
1:02:49
So I'm going to make the light on the table here. It's not very bright.
1:02:53
I turn the classroom lights on full, bright. All the way 100%.
1:02:58
So like technically in real life, these are adding to each other.
1:03:07
So we're faking that. But essentially that now is lighting this brighter than it is lighting itself.
1:03:11
Right. So like my phone now even more lit than the phone itself, even though the phone is a light source.
1:03:19
So yes, the square that the phone is in is brighter because of someone else lighting it.
1:03:25
But if you turn off the lights then this will be the only thing left that's lit.
1:03:32
So it'll drop down from five for three, but then it'll stop at three because this is a three point source.
1:03:39
We also already know that every light source is not even being lit up because of its own value.
1:03:45
So you can see that because of its neighbor. So why no no no no no no. That's you're talking about polygons.
1:03:50
We haven't we haven't. There are no polygons. This is a 2D.
1:03:55
This is a text based adventure. There are no polygons for vertex coloring.
1:03:59
Yes. We have to say what is the volume here?
1:04:03
Say what's the color here? And that determines what this face of this face is for.
1:04:09
It's our list. But that's a totally separate step.
1:04:14
We haven't even got to that. And at that point, you're just assigning reds and greens to vertex colors based on ones and twos,
1:04:18
with no sense at all about who's a light source and who isn't.
1:04:29
It's just light values at that point. Does that make sense? Right.
1:04:33
So let Sandy point to Isaac that we're doing our job.
1:04:38
Uh, for later life insurance values.
1:04:44
They're getting into value. Yes. To explain matters for, like, light influence and things.
1:04:48
You guys, do you think that, uh, they, um, gave definition like influence?
1:04:57
That's absolutely right. Two totally different things. So from a block, I can say, hey, get the block definition for me.
1:05:03
So what type of block? And for me I just say take my block type and ask what the block def says.
1:05:12
So what is the block def say. One of the things it says is how much indoor light it gives out.
1:05:19
15 for glowstone, zero for everyone else, maybe. And I could easily put an outdoor light emission if I wanted.
1:05:26
Blocks that give out lightning light from whatever. That's all in the block.
1:05:33
Def in the block itself. We have.
1:05:38
Hey, give me your current light influence level or set your current light influence level one.
1:05:43
Remember we're doing two different ones. So this whole thing is happening for indoor light and also for outdoor light.
1:05:50
But I would just get one of those working first indoor light. What does that get?
1:05:56
Indoor light influence. Do just some bit magic because and this the assignment says this.
1:06:01
We're basically saying we have block lighting is a new member variable.
1:06:09
So we now have three different bytes in our block instead of one byte.
1:06:13
We have what type we are zero for air, nine for gold.
1:06:18
We have the colliding bits, which is four bits which can count from 0 to 15.
1:06:23
That's why it's 15. It's because we have half a byte. We're allocating to it.
1:06:29
If we wanted more light levels, we'd have to allocate a whole byte to it and then it could go out, you know.
1:06:34
Um, 256. That's in the bottom four bits, and then in the top four bits, we're going to shove a different end from 0 to 15.
1:06:39
It's kind of like we shoved X in the bottom four bits and then Y in the next four bits and then Z.
1:06:49
We're doing the same thing, except we're showing you showing the indoor light zero through 15,
1:06:54
and then the outdoor light zero through 15, both in one byte just to save space.
1:06:58
But we also have to have some true false rules that we have to park on this on this thing.
1:07:04
One of them we said is the is in the dirty list bit.
1:07:11
That seems like, well, do we really want to add a whole third bite for that?
1:07:17
Well, no, because it ends up there are lots of other bit flags we end up needing to add anyway.
1:07:20
One of those is can I see the sky is part of how we're going to make the sky propagation be really fast.
1:07:26
Another one is um. Like.
1:07:33
Uh. Let's see.
1:07:38
I don't mean we have some examples in the assignment. Um.
1:07:42
Oh. Am I opaque? Because we're going to be asking millions of times.
1:07:55
Are you opaque? Are you opaque or are you opaque? And so instead of going get to the block, go to the definition.
1:07:59
Ask the definition if it's opaque. We're actually going to sort of optimize that by saying the block itself will store a bit.
1:08:05
So you can just it knows right away whether it's opaque.
1:08:12
It's also going to know whether it's solid or whether it's visible. Later we're going to have lots of different visible and invisible block types.
1:08:15
So instead of saying are you er, or are you a monster blocker or are you a clip brush or are you all these different invisible block types?
1:08:23
We'll just ask the block, are you visible? And if not, we'll skip your rendering.
1:08:29
So that also speeds up mash building and some other things.
1:08:34
Um. Solid is going to be really useful for speeding up our physics.
1:08:39
So we just can quickly ask, are you a solid block or not? Do I do physics against you rather than having to go fetch the definitions constantly?
1:08:44
So all these bits are going to be bit flags within that third byte, which is this.
1:08:52
How is that on women's issues? I mean, uh, like, no definition.
1:08:59
Just hang up. Van Buren, bye bye. Yeah, I know mine last night.
1:09:04
So I think one short complaint is that they getting their definition.
1:09:09
Uh, and then you've just directly had a good view of where it is today.
1:09:15
So they by optimize, you mean like function calls.
1:09:20
I mean, the amount of memory we touch. Versus the amount of memory we need to touch.
1:09:25
So cache coherency. Um, there's a lot of data in the blocked apps, and they're going to get bigger and bigger and bigger.
1:09:31
They're going to have lists of sounds that we play. They're going to have all kinds of stuff.
1:09:38
So they're going to be very cache unfriendly.
1:09:42
So if we if we go to the block devs, we want to do it 10 or 100,000 times a frame, not a billion times a frame.
1:09:45
And for these things we were just we can load, you know, 20 blocks in the cache or whatever in one cache line.
1:09:54
And that includes all the information about whether those blocks are solid, whether they're opaque,
1:10:03
whether they're part of the sky, whether they're dirty, what type they are, how bright their lighting is.
1:10:07
That can all be in that one cache line that we paid for anyway.
1:10:13
So it just ends up being faster. We can actually there's another optimization we can do, which is.
1:10:17
Based on what our Nate. Whether our neighbors are opaque like,
1:10:24
we could build bid flags for whether my faces even need to be seen so we could massively
1:10:28
optimize our hidden surface removal by also storing extra information bits about that.
1:10:34
But then we have to update those whenever we dig. But it ends up being we dig once for every million times we check.
1:10:39
And so we tend to have data structures that are slower to modify and faster to query.
1:10:47
So, um. But yeah, it's all just.
1:10:52
Just trade offs. Okay, we are unfortunately out of time, but that's I think we're out of brainpower also.
1:10:56
So that's a good stopping point. Please start by reading through the assignment.
1:11:05
Read through the lighting algorithm. Try working it out on paper like some some things.
1:11:12
But my suggestion is you start with the raycast and the digging.
1:11:17
Because you should be able to know how to. Know how to be able to do that.
1:11:24
And it's just a 3D version of the amenity through. Algorithm.
1:11:27
And in this light algorithm from removable and rotations is pretty much the same thing because we can all use the same words.
1:11:31
It's not like a o in isinglass or deep. Correct.
1:11:38
Well, yeah. And in some ways it simplifies it because.
1:11:42
You can have weird cases. For example, you have got skylights streaming down and filling a cave.
1:11:46
But then you plug the hole with glowstone.
1:11:53
So you're like, okay, now I'm stopping the skylight from coming in, but I am I am myself a source of light, but it's a different kind of light.
1:11:56
So it's like can be increasing and decreasing and it's just easier just to say it's either right or it's wrong and propagate.
1:12:03
Yeah. Because that way we would need to light value but we would have the same like.
1:12:10
Right. Are you dirty for this or for this. We just sort of check both every time.
1:12:16
Always. Of course. If we really were shipping this.
1:12:20
There are always a million ways we could optimize the world, but this is about the simplest way we can make it work in real time.
1:12:27
All right, let's dive in. I love it.
1:12:37
I mean, look, it doesn't make me look like somebody like you.
1:12:43
Yeah, but if it's atomic, it's, like, 50 times slower than not an atomic.
1:12:51
So it ends up being easier just to say all that lighting will be done only ever on this one thread.
1:13:00
And. But then we have to be really careful about separating the data.
1:13:06
Yeah. It gets gets complicated.
1:13:10
Yeah. So. And I'm not even being, like, playing teacher there.
1:13:13
I'm just saying it's legit, you know.
1:13:18
Once we start getting into threading, then it's like four senior programmers arguing for four days to figure out the best way to do it,
1:13:22
and then they're going to make a guess and try it out. Yeah I know.
1:13:29
I mean, I. I think so.
1:13:33
Yeah.
1:13:37