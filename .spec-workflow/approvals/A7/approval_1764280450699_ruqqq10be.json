{
  "id": "approval_1764280450699_ruqqq10be",
  "title": "Review A7 Design Document (PARTIAL): design.md",
  "filePath": ".spec-workflow/specs/A7/design.md",
  "type": "document",
  "status": "needs-revision",
  "createdAt": "2025-11-27T22:07:30.699Z",
  "category": "spec",
  "categoryName": "A7",
  "description": "Requesting approval for **design.md** - **PARTIAL VERSION** (Assignment 7 design document):\n\n**‚ö†Ô∏è STATUS: INCOMPLETE**\nThis is a partial design document covering the first 4 sections. Remaining sections will be added after approval of this foundation.\n\n**Sections Completed (Approx. 1,000 lines):**\n\n## 1. ‚úÖ P-1: Rendering Bug Fix (COMPLETE)\n**Problem:** Block faces incorrectly hidden at chunk boundaries when neighboring chunks are not loaded.\n\n**Root Cause:** `Chunk.cpp:3632` - `IsFaceVisible()` returns `false` when `neighborIter.IsValid()` is false, assuming unloaded chunks are opaque.\n\n**Solution:**\n```cpp\n// OLD (BUGGY): return false;  // Assume unloaded = opaque\n// NEW (FIXED): return true;   // Assume unloaded = transparent (air)\n```\n\n**Rationale:**\n- Better to render extra faces temporarily than hide visible ones\n- Minecraft renders chunk boundaries optimistically\n- Face will be hidden when neighbor chunk loads (mesh rebuild)\n- Small performance impact (~16-32 extra quads per chunk edge)\n\n**Verification:**\n- ‚úÖ Surface chunk boundaries show all visible faces\n- ‚úÖ Underground cave boundaries are continuous\n- ‚úÖ Building across chunks has no missing faces\n- ‚úÖ Chunk load/unload cycle correctly rebuilds meshes\n\n---\n\n## 2. ‚úÖ System Architecture Overview (COMPLETE)\n\n**Layer Architecture:**\n```\nKADI Integration ‚Üí UI Layer ‚Üí Gameplay Layer ‚Üí Core Systems ‚Üí Engine Layer\n```\n\n**Component Dependency Graph:**\n- Game.cpp ‚Üí App ‚Üí World (Player, AIAgent, ItemEntity)\n- WidgetSubsystem ‚Üí HotbarWidget, InventoryWidget, CraftingWidget\n- KADIWebSocketSubsystem ‚Üí KADIToolHandler ‚Üí AgentCommandExecutor\n- Registries: BlockRegistry, ItemRegistry, RecipeRegistry (JSON-based)\n\n**Module Boundaries:**\n- ‚úÖ Engine ‚Üí Game (one-way dependency)\n- ‚ùå Engine CANNOT include Game headers\n\n---\n\n## 3. ‚úÖ Registry System Design (COMPLETE)\n\n**Generic Template Class:**\n```cpp\ntemplate <typename T>\nclass Registry\n{\n    void Register(std::string const& name, T* object);\n    uint16_t GetID(std::string const& name) const;\n    T* Get(uint16_t id) const;\n    // ... thread-safe, case-insensitive lookup\n};\n```\n\n**Block Registry Migration:**\n- **OLD**: Static `s_definitions` vector, hardcoded in C++\n- **NEW**: JSON-based registry with `nlohmann/json` parsing\n- **File**: `Run/Data/Definitions/BlockDefinitions.json`\n\n**Item Registry:**\n- `ItemDefinition` class with `eItemType` enum (RESOURCE, TOOL, BLOCK, CONSUMABLE)\n- Tool properties: mining speed, durability\n- Block properties: references BlockRegistry ID\n- **File**: `Run/Data/Definitions/ItemDefinitions.json`\n\n**Recipe Registry:**\n- `Recipe` class with `eRecipeType` (SHAPED, SHAPELESS)\n- 2√ó2 crafting grid support\n- Pattern matching algorithm for shaped recipes\n- **File**: `Run/Data/Definitions/Recipes.json`\n\n---\n\n## 4. ‚úÖ Inventory System Design (COMPLETE)\n\n**ItemStack Structure:**\n```cpp\nstruct ItemStack  // 6 bytes\n{\n    uint16_t itemID;      // ItemRegistry ID\n    uint8_t  quantity;    // 1-255\n    uint16_t durability;  // For tools\n};\n```\n\n**Inventory Class:**\n- 36 total slots (27 main + 9 hotbar)\n- Minecraft-standard layout\n- Operations: AddItem, RemoveItem, SwapSlots, MergeSlots\n- JSON serialization for save/load\n\n**ItemEntity (World Drops):**\n- Extends `Entity` (physics-enabled)\n- Magnetic attraction to player (3 block radius)\n- Pickup cooldown (0.5s after drop)\n- Despawn timer (5 minutes)\n- Item stacking (multiple same items merge)\n\n---\n\n**Sections NOT YET Included (Will Add After Approval):**\n\n5. ‚è≥ Mining & Placement Mechanics\n   - Progressive block breaking with visual cracks\n   - Tool effectiveness system\n   - Block placement validation\n   - Raycast targeting (6 block range)\n\n6. ‚è≥ UI System Design\n   - HotbarWidget (bottom-center HUD)\n   - InventoryWidget (full screen, modal)\n   - CraftingWidget (2√ó2 grid with output slot)\n   - WidgetSubsystem refinements\n\n7. ‚è≥ AI Agent Framework Design\n   - AIAgent entity class\n   - AgentCommand system (MOVE, MINE, PLACE, CRAFT, WAIT)\n   - AgentVision (nearby blocks/entities)\n   - Command queue execution\n\n8. ‚è≥ KADI WebSocket Integration\n   - KADIToolHandler (JSON-RPC ‚Üí C++)\n   - 7 MCP tools (SimpleMiner_Spawn_Agent, SimpleMiner_Move_Agent, etc.)\n   - AgentCommandExecutor\n   - WebSocket protocol flow\n\n9. ‚è≥ Menu System Design\n   - Create New Game\n   - Load Game (list saved worlds)\n   - Save Game (JSON player state)\n   - Enhanced AttractMode\n\n10. ‚è≥ Sound Effects Integration\n   - Mining sounds (per block type)\n   - Placement sounds\n   - Crafting sounds\n   - UI sounds (button click, inventory open)\n   - AudioSystem integration\n\n11. ‚è≥ Data Flow Diagrams\n   - Mining flow (input ‚Üí raycast ‚Üí break ‚Üí drop)\n   - Crafting flow (grid ‚Üí recipe match ‚Üí output)\n   - AI agent flow (KADI ‚Üí tool ‚Üí command ‚Üí world)\n\n12. ‚è≥ Class Hierarchies\n   - Entity inheritance diagram\n   - Widget inheritance diagram\n   - Definition class relationships\n\n13. ‚è≥ JSON Schema Definitions\n   - Complete schemas for all JSON files\n   - Validation rules\n\n14. ‚è≥ Implementation Strategy\n   - Phase-by-phase breakdown\n   - Task dependencies\n   - Testing checkpoints\n\n---\n\n**Why Partial Approval?**\n\n1. **Foundation Sections Are Critical**: P-1 fix, architecture, registry, and inventory are the foundation for all other systems\n2. **Early Feedback**: Get approval on architectural decisions before designing dependent systems\n3. **Manageable Review Size**: ~1,000 lines is easier to review than a massive 3,000+ line document\n4. **Iterative Design**: Incorporate feedback into remaining sections\n\n**Next Steps After Approval:**\n\n1. ‚úÖ Foundation approved (P-1, architecture, registry, inventory)\n2. üîÑ Add remaining 10 sections to design.md\n3. üì¨ Request approval for complete design.md\n4. ‚úÖ After full design approved, create tasks.md\n5. üöÄ Begin implementation\n\n**File Location:**\n`.spec-workflow/specs/A7/design.md`\n\n**Please Review:**\n- ‚úÖ P-1 rendering bug fix solution (line 3632 change)\n- ‚úÖ System architecture and layer design\n- ‚úÖ Generic Registry<T> template approach\n- ‚úÖ JSON-based registry migration strategy\n- ‚úÖ ItemStack structure (6 bytes, pass-by-value)\n- ‚úÖ Inventory class (36 slots, Minecraft layout)\n- ‚úÖ ItemEntity behavior (magnetic pickup, despawn timer)",
  "response": "Feedback Summary (3 comments):\n\nSpecific Text Comments:\n1. \"P-1:\": Please remove all P-1 in the design.md because it's confusing.\n2. \"6. **AI Agent Framework** - KADI WebSocket-integra...\": Remember that this should probably be the last thing to implement.\n3. \"This is getting quite long. Let me continue with t...\": I'm seeing you writing this, do you think that we should split this into different spec? This means that will need to split the current requirements.md under A7 spec\n",
  "annotations": "{\n  \"decision\": \"needs-revision\",\n  \"comments\": [\n    {\n      \"type\": \"selection\",\n      \"comment\": \"Please remove all P-1 in the design.md because it's confusing.\",\n      \"timestamp\": \"2025-11-28T01:03:55.486Z\",\n      \"selectedText\": \"P-1:\",\n      \"highlightColor\": {\n        \"bg\": \"rgba(255, 235, 59, 0.3)\",\n        \"border\": \"#FFEB3B\",\n        \"name\": \"#ffeb3b\"\n      },\n      \"id\": \"comment_1764291835486_haqpdfitt\"\n    },\n    {\n      \"type\": \"selection\",\n      \"comment\": \"Remember that this should probably be the last thing to implement.\",\n      \"timestamp\": \"2025-11-28T01:04:57.858Z\",\n      \"selectedText\": \"6. **AI Agent Framework** - KADI WebSocket-integrated autonomous agents\",\n      \"highlightColor\": {\n        \"bg\": \"rgba(255, 235, 59, 0.3)\",\n        \"border\": \"#FFEB3B\",\n        \"name\": \"#ffeb3b\"\n      },\n      \"id\": \"comment_1764291897858_or24spa0n\"\n    },\n    {\n      \"type\": \"selection\",\n      \"comment\": \"I'm seeing you writing this, do you think that we should split this into different spec? This means that will need to split the current requirements.md under A7 spec\",\n      \"timestamp\": \"2025-11-28T01:08:59.158Z\",\n      \"selectedText\": \"This is getting quite long. Let me continue with the remaining sections. Should I proceed with the rest of the design document (Mining & Placement, UI, AI Agents, KADI, Menu, Sound, Data Flow, etc.)?\",\n      \"highlightColor\": {\n        \"bg\": \"rgba(255, 235, 59, 0.3)\",\n        \"border\": \"#FFEB3B\",\n        \"name\": \"#ffeb3b\"\n      },\n      \"id\": \"comment_1764292139158_rscwgowk0\"\n    }\n  ],\n  \"summary\": \"Feedback Summary (3 comments):\\n\\nSpecific Text Comments:\\n1. \\\"P-1:\\\": Please remove all P-1 in the design.md because it's confusing.\\n2. \\\"6. **AI Agent Framework** - KADI WebSocket-integra...\\\": Remember that this should probably be the last thing to implement.\\n3. \\\"This is getting quite long. Let me continue with t...\\\": I'm seeing you writing this, do you think that we should split this into different spec? This means that will need to split the current requirements.md under A7 spec\\n\",\n  \"timestamp\": \"2025-11-28T01:09:14.820Z\"\n}",
  "respondedAt": "2025-11-28T01:09:14.923Z",
  "comments": [
    {
      "type": "selection",
      "comment": "Please remove all P-1 in the design.md because it's confusing.",
      "timestamp": "2025-11-28T01:03:55.486Z",
      "selectedText": "P-1:",
      "highlightColor": {
        "bg": "rgba(255, 235, 59, 0.3)",
        "border": "#FFEB3B",
        "name": "#ffeb3b"
      },
      "id": "comment_1764291835486_haqpdfitt"
    },
    {
      "type": "selection",
      "comment": "Remember that this should probably be the last thing to implement.",
      "timestamp": "2025-11-28T01:04:57.858Z",
      "selectedText": "6. **AI Agent Framework** - KADI WebSocket-integrated autonomous agents",
      "highlightColor": {
        "bg": "rgba(255, 235, 59, 0.3)",
        "border": "#FFEB3B",
        "name": "#ffeb3b"
      },
      "id": "comment_1764291897858_or24spa0n"
    },
    {
      "type": "selection",
      "comment": "I'm seeing you writing this, do you think that we should split this into different spec? This means that will need to split the current requirements.md under A7 spec",
      "timestamp": "2025-11-28T01:08:59.158Z",
      "selectedText": "This is getting quite long. Let me continue with the remaining sections. Should I proceed with the rest of the design document (Mining & Placement, UI, AI Agents, KADI, Menu, Sound, Data Flow, etc.)?",
      "highlightColor": {
        "bg": "rgba(255, 235, 59, 0.3)",
        "border": "#FFEB3B",
        "name": "#ffeb3b"
      },
      "id": "comment_1764292139158_rscwgowk0"
    }
  ]
}